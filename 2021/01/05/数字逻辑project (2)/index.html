



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="Hexo" href="http://example.com/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Hexo" href="http://example.com/atom.xml" />
<link rel="alternate" type="application/json" title="Hexo" href="http://example.com/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  

<link rel="canonical" href="http://example.com/2021/01/05/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91project%20(2)/">



  <title>
Degital Design Project |
Cheese Bar = Hexo</title>
<meta name="generator" content="Hexo 5.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Degital Design Project
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2021-01-05 18:34:14">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2021-01-05T18:34:14+08:00">2021-01-05</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Cheese Bar</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclhnx9glj20zk0m8npd.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipeyvx1d4j20zk0m8hdt.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipevuctzzj20zk0m84qp.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicitspjpbj20zk0m81ky.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipexj2jgzj20zk0m8b09.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/05/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91project%20(2)/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="数字逻辑Project报告"><a href="#数字逻辑Project报告" class="headerlink" title="数字逻辑Project报告"></a><center>数字逻辑Project报告</center></h1><h2 id="——智能空调（你说得都队）"><a href="#——智能空调（你说得都队）" class="headerlink" title="       ——智能空调（你说得都队）"></a><center>       ——智能空调（你说得都队）</center></h2><hr>
<h3 id="一、开发计划"><a href="#一、开发计划" class="headerlink" title="一、开发计划"></a>一、开发计划</h3><h4 id="（一）任务划分"><a href="#（一）任务划分" class="headerlink" title="（一）任务划分"></a>（一）任务划分</h4><ul>
<li>刘仁杰：基本框架搭建, 任务划分, 空调初始化, 开机模式状态变更, 温度设定功能, 充电模块, 各模块整合, 代码重构, 系统综合；(40%)</li>
<li>朱世博：各状态显示模块、音乐模块、定时关机模块；(30%)</li>
<li>张皓淇：充电模块、小键盘、外挂音乐模块、电量充值记录查询模块。(30%)</li>
</ul>
<h4 id="（二）进度安排"><a href="#（二）进度安排" class="headerlink" title="（二）进度安排"></a>（二）进度安排</h4><p>11.28 确定任务划分，熟悉各自模块的设计要求</p>
<p>12.13 完成各个子模块的开发任务，开始进行模块整合</p>
<p>12.20 完成模块整合，开始进行bonus部分的开发</p>
<h4 id="（三）执行记录"><a href="#（三）执行记录" class="headerlink" title="（三）执行记录"></a>（三）执行记录</h4><p>11.28  完成任务划分</p>
<p>11.29~12.6 不知如何上手, 加上其他课业压力, 停工一周</p>
<p>12.7 迫于DDL压力, 开始着手搭建框架</p>
<p>12.8 完成基本框架的搭建, 进一步明确分工 </p>
<p>12.16  完成各个子模块的开发任务，开始进行模块整合</p>
<p>12.17~12.19 模块整合受阻, 上板测试失败, 开始着手重构代码</p>
<p>12.20  完成模块整合，实现系统基本功能，开始进行bonus部分的开发</p>
<p>12.23 23:00 完成定时关机模块的开发，开始整合</p>
<p>12.24 1:00 完成电量充值记录查询模块的开发</p>
<p>12.24 4:00 定时关机模块整合完毕，音乐模块开发完毕</p>
<p>12.24 6:00 电量充值记录查询模块整合失败</p>
<p>12.24 6:30 完成演示视频的录制</p>
<hr>
<h3 id="二、设计"><a href="#二、设计" class="headerlink" title="二、设计"></a>二、设计</h3><h4 id="（一）需求分析"><a href="#（一）需求分析" class="headerlink" title="（一）需求分析"></a>（一）需求分析</h4><h5 id="功能确定"><a href="#功能确定" class="headerlink" title="功能确定"></a>功能确定</h5><blockquote>
<ol>
<li>智能空调初始化、状态控制及信息显示功能</li>
<li>智能开机状态的模式控制功能</li>
<li>智能空调温度设定功能</li>
<li>电量充值功能</li>
<li>电量充值记录查询功能</li>
<li>定时关机功能</li>
<li>音乐</li>
</ol>
</blockquote>
<h5 id="输入输出设备及端口绑定"><a href="#输入输出设备及端口绑定" class="headerlink" title="输入输出设备及端口绑定"></a>输入输出设备及端口绑定</h5><blockquote>
<p>输入设备: </p>
<ul>
<li>矩阵键盘, 五个按键, 4个拨码开关</li>
</ul>
<p>输出设备: </p>
<ul>
<li>一个LED灯, 七段数码显示管</li>
</ul>
<p>端口绑定: </p>
<ul>
<li><p>矩阵键盘对应充电量和定时关机设定</p>
</li>
<li><p>五个按键分别对应翻页操作显示信息的切换, 设定温度的上下调节, 制冷制热送风三种模式的上下切换, 剩余电量的显示, 设定定时关机的显示</p>
</li>
<li><p>四个拨码开关分别对应开关机, 系统初始化, 充电模式和设定关机时间的进入, 剩余电量查询</p>
</li>
<li><p>一个LED灯对应显示输出结束</p>
</li>
<li><p>七段数码显示管对应空调所有信息的显示</p>
</li>
</ul>
</blockquote>
<h4 id="（二）系统结构图"><a href="#（二）系统结构图" class="headerlink" title="（二）系统结构图"></a>（二）系统结构图</h4><blockquote>
<p><img data-src="%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt="结构图"></p>
</blockquote>
<h4 id="（三）系统执行流程"><a href="#（三）系统执行流程" class="headerlink" title="（三）系统执行流程"></a>（三）系统执行流程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line"></span><br><span class="line">M---&gt;G[关机]--&gt;F[电量充值]</span><br><span class="line">G--&gt;H[充值记录]</span><br><span class="line">M[空调]--&gt;A</span><br><span class="line">A[开机] --&gt;B(显示:左右键切换)</span><br><span class="line">    </span><br><span class="line">    B --&gt; View0[模式选择:上下键切换]</span><br><span class="line">    B --&gt; View1[温度设定]</span><br><span class="line">    B --&gt; View2[倒计时关机] </span><br><span class="line">    B --&gt; View3[余电查看] --&gt;显示当前电量</span><br><span class="line">       </span><br><span class="line">    View0--&gt;mode0[制冷]--&gt;|达到设定温度|mode1</span><br><span class="line">    View0--&gt;|默认|mode1[送风]</span><br><span class="line">    View0--&gt;mode2[制热]--&gt;|达到设定温度|mode1</span><br><span class="line">    </span><br><span class="line">    View1--&gt;|上键|top1[最高30摄氏度]</span><br><span class="line"> 	View1--&gt;|下键|top2[最低20摄氏度]</span><br><span class="line"> 	</span><br><span class="line"> 	View2 --&gt;设定倒计时</span><br><span class="line"> 	View2 --&gt;10s剩余时响铃提醒</span><br><span class="line"></span><br><span class="line">M--&gt;music</span><br></pre></td></tr></table></figure>
<h4 id="（四）子模块代码"><a href="#（四）子模块代码" class="headerlink" title="（四）子模块代码"></a>（四）子模块代码</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//顶层模块</span></span><br><span class="line"><span class="keyword">module</span> view_top(</span><br><span class="line">    <span class="comment">// 拨码开关(开关机, 1为开机, 0为关机), 板上时钟, 小键盘(1个4bit行), 五个小按钮(上下左右中)</span></span><br><span class="line">    <span class="keyword">input</span> on_off, rst, lookup, clk, [<span class="number">3</span>:<span class="number">0</span>] row,</span><br><span class="line">    <span class="keyword">input</span> up_level, down_level, left_level, right_level, middle_level, ifcharge,</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] DIG,    <span class="comment">//8个 扫描一个</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] Y,      <span class="comment">//输出的内容</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] col, <span class="comment">// 小键盘的列</span></span><br><span class="line">    <span class="keyword">output</span> charge_end, <span class="comment">// 充电结束</span></span><br><span class="line">    <span class="keyword">output</span> beep <span class="comment">// 蜂鸣器</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] mode; <span class="comment">// 模式</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>] setT; <span class="comment">// 设定温度</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>] envT; <span class="comment">// 环境温度</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>] elec; <span class="comment">// 电量</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>] charge; <span class="comment">// 充电量</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>] set_time; <span class="comment">// 设置倒计时</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>] count_down; <span class="comment">// 倒计时</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>] chargeInfo; <span class="comment">// 充值记录</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] select = <span class="number">2&#x27;b01</span>; <span class="comment">//01温度, 10电量, 11模式</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_t;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_e;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_m;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_c;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_d;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_l;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] Y_t;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] Y_e;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] Y_m;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] Y_c;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] Y_d;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] Y_l;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> up, down, left, right, middle;</span><br><span class="line">    <span class="keyword">wire</span> ifon;</span><br><span class="line">    <span class="keyword">wire</span> shutdown;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 按键防抖</span></span><br><span class="line">    key_vibration vibration(clk, rst, &#123;up_level, down_level, left_level, right_level, middle_level&#125;, &#123;up, down, left, right, middle&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 温度显示</span></span><br><span class="line">    view_temp tempV( on_off, ifon, shutdown, rst, clk, envT, setT, DIG_t ,Y_t );</span><br><span class="line">    <span class="comment">// 电量显示</span></span><br><span class="line">    view_elec elecV( on_off, rst, clk, elec, DIG_e , Y_e );</span><br><span class="line">    <span class="comment">// 模式显示</span></span><br><span class="line">    view_mode modeV( on_off, rst, clk, mode, DIG_m , Y_m );</span><br><span class="line">    <span class="comment">// 充电显示</span></span><br><span class="line">    view_charge chargeV(on_off, ifon, rst, clk, elec, charge, DIG_c, Y_c);</span><br><span class="line">    <span class="comment">// 倒计时显示</span></span><br><span class="line">    view_time2 timeV(on_off, ifon, shutdown, rst, clk, set_time, count_down, DIG_d, Y_d);</span><br><span class="line">    <span class="comment">// 点亮查询显示</span></span><br><span class="line">    view_chargehistory history(rst, clk, chargeInfo, DIG_l, Y_l);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 与controller链接</span></span><br><span class="line">    controller_top controller(on_off, rst, lookup, clk, row, up, down, left, 	right, middle, ifcharge, select, mode, setT, envT, elec, col, ifon, charge, 	charge_end, set_time, count_down, shutdown, beep, chargeInfo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模式选择, 开机状态下翻页显示</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (left &amp;&amp; on_off) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (select == <span class="number">3</span>) <span class="keyword">begin</span></span><br><span class="line">                select &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                select &lt;= select + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (right &amp;&amp; on_off) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (select == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                select &lt;= <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                select &lt;= select - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关机状态下充电显示和任意时刻电量查询</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (lookup) <span class="keyword">begin</span></span><br><span class="line">            Y &lt;= Y_l;</span><br><span class="line">            DIG &lt;= DIG_l;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!(on_off &amp;&amp; ifon &amp;&amp; shutdown)) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (ifcharge) <span class="keyword">begin</span></span><br><span class="line">                Y &lt;= Y_c;</span><br><span class="line">                DIG &lt;= DIG_c;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                Y &lt;= Y_t;</span><br><span class="line">                DIG &lt;= DIG_t;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (select == <span class="number">2&#x27;b00</span>) <span class="keyword">begin</span></span><br><span class="line">                Y &lt;= Y_d;</span><br><span class="line">                DIG &lt;= DIG_d;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (select == <span class="number">2&#x27;b01</span>) <span class="keyword">begin</span></span><br><span class="line">                Y &lt;= Y_t;</span><br><span class="line">                DIG &lt;= DIG_t;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (select == <span class="number">2&#x27;b10</span>) <span class="keyword">begin</span></span><br><span class="line">                Y &lt;= Y_e;</span><br><span class="line">                DIG &lt;= DIG_e;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (select == <span class="number">2&#x27;b11</span>) <span class="keyword">begin</span></span><br><span class="line">                Y &lt;= Y_m;</span><br><span class="line">                DIG &lt;= DIG_m;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="防抖模块-延时10ms得到稳定电平信号"><a href="#防抖模块-延时10ms得到稳定电平信号" class="headerlink" title="防抖模块(延时10ms得到稳定电平信号)"></a>防抖模块(延时10ms得到稳定电平信号)</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> key_vibration(</span><br><span class="line">    <span class="keyword">input</span>		  	 mclk,</span><br><span class="line">	<span class="keyword">input</span>		  	 rst_n,</span><br><span class="line">	<span class="keyword">input</span>	   [<span class="number">4</span>:<span class="number">0</span>] key,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] key_en</span><br><span class="line">	);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">parameter</span> DURATION = <span class="number">50_000</span>;<span class="comment">//延时10ms	</span></span><br><span class="line">	<span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] cnt; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">wire</span> ken_enable;</span><br><span class="line">	<span class="keyword">assign</span> ken_enable = key[<span class="number">4</span>] | key[<span class="number">3</span>] | key[<span class="number">2</span>] | key[<span class="number">1</span>] | key[<span class="number">0</span>]; <span class="comment">//只要任意按键被按下，相应的按键进行消抖</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">always</span> @(<span class="keyword">posedge</span> mclk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n)</span><br><span class="line">	<span class="keyword">begin</span></span><br><span class="line">		<span class="keyword">if</span>(!rst_n)</span><br><span class="line">			cnt &lt;= <span class="number">11&#x27;d0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(ken_enable == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">			<span class="keyword">if</span>(cnt == DURATION)</span><br><span class="line">				cnt &lt;= cnt;</span><br><span class="line">			<span class="keyword">else</span> </span><br><span class="line">				cnt &lt;= cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line">			<span class="keyword">end</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			cnt &lt;= <span class="number">16&#x27;b0</span>;</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">always</span> @(<span class="keyword">posedge</span> mclk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) </span><br><span class="line">	<span class="keyword">begin</span></span><br><span class="line">		<span class="keyword">if</span>(!rst_n) key_en &lt;= <span class="number">5&#x27;d0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(key[<span class="number">0</span>]) key_en[<span class="number">0</span>] &lt;= (cnt == DURATION-<span class="number">1&#x27;b1</span>) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(key[<span class="number">1</span>]) key_en[<span class="number">1</span>] &lt;= (cnt == DURATION-<span class="number">1&#x27;b1</span>) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(key[<span class="number">2</span>]) key_en[<span class="number">2</span>] &lt;= (cnt == DURATION-<span class="number">1&#x27;b1</span>) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(key[<span class="number">3</span>]) key_en[<span class="number">3</span>] &lt;= (cnt == DURATION-<span class="number">1&#x27;b1</span>) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(key[<span class="number">4</span>]) key_en[<span class="number">4</span>] &lt;= (cnt == DURATION-<span class="number">1&#x27;b1</span>) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">		<span class="keyword">else</span> key_en &lt;= key_en;</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="二进制–-gt-BCD转换模块-采用满5加3算法"><a href="#二进制–-gt-BCD转换模块-采用满5加3算法" class="headerlink" title="二进制–&gt;BCD转换模块(采用满5加3算法)"></a>二进制–&gt;BCD转换模块(采用满5加3算法)</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Bin_BCD(</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] binary,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">11</span>:<span class="number">0</span>] decimal</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] hundreds;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] tens;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] ones;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> decimal = &#123;hundreds[<span class="number">3</span>:<span class="number">0</span>], tens[<span class="number">3</span>:<span class="number">0</span>], ones[<span class="number">3</span>:<span class="number">0</span>]&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="keyword">always</span> @(binary) <span class="keyword">begin</span></span><br><span class="line">        hundreds = <span class="number">4&#x27;d0</span>;</span><br><span class="line">        tens = <span class="number">4&#x27;d0</span>;</span><br><span class="line">        ones = <span class="number">4&#x27;d0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">9</span>; i &gt;= <span class="number">0</span>; i = i - <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">// 满5加3</span></span><br><span class="line">            <span class="keyword">if</span> (hundreds &gt;= <span class="number">5</span>) <span class="keyword">begin</span></span><br><span class="line">                hundreds = hundreds + <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> (tens &gt;= <span class="number">5</span>) <span class="keyword">begin</span></span><br><span class="line">                tens = tens + <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> (ones &gt;= <span class="number">5</span>) <span class="keyword">begin</span></span><br><span class="line">                ones = ones + <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 向左移位</span></span><br><span class="line">            hundreds = hundreds &lt;&lt; <span class="number">1</span>;</span><br><span class="line">            hundreds[<span class="number">0</span>] = tens[<span class="number">3</span>];</span><br><span class="line">            tens = tens &lt;&lt; <span class="number">1</span>;</span><br><span class="line">            tens[<span class="number">0</span>] = ones[<span class="number">3</span>];</span><br><span class="line">            ones = ones &lt;&lt; <span class="number">1</span>;</span><br><span class="line">            ones[<span class="number">0</span>] = binary[i];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="时钟分频模块-分频1s时钟"><a href="#时钟分频模块-分频1s时钟" class="headerlink" title="时钟分频模块(分频1s时钟)"></a>时钟分频模块(分频1s时钟)</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> div_frequency(</span><br><span class="line">    <span class="keyword">input</span> clk,  <span class="comment">//Y18</span></span><br><span class="line">    <span class="keyword">input</span> rst,  <span class="comment">//复位</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> clkout <span class="comment">//输出时钟</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">parameter</span> period = <span class="number">100000000</span>;<span class="comment">//1s</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (!rst) <span class="keyword">begin</span></span><br><span class="line">        cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        clkout &lt;=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(cnt == (period&gt;&gt;<span class="number">1</span>)-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            clkout &lt;= ~clkout;</span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cnt &lt;= cnt+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="温度显示模块"><a href="#温度显示模块" class="headerlink" title="温度显示模块"></a>温度显示模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> view_temp(</span><br><span class="line">    <span class="keyword">input</span> on_off, ifon_elec, ifon_time,</span><br><span class="line">    <span class="keyword">input</span> rst,  <span class="comment">//复位</span></span><br><span class="line">    <span class="keyword">input</span> clk, <span class="comment">//Y18</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">11</span>:<span class="number">0</span>] envT,  <span class="comment">//环境温度</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">11</span>:<span class="number">0</span>] setT,  <span class="comment">//设定温度</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] DIG,     <span class="comment">//8个 扫描一个</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] Y        <span class="comment">//输出的内容</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> clkout;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] scan_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> period = <span class="number">200000</span>; <span class="comment">//500Hz</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] bcd;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] seg_out;</span><br><span class="line">    <span class="keyword">reg</span> dot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> Y = &#123;dot,(~seg_out[<span class="number">6</span>:<span class="number">0</span>])&#125;;</span><br><span class="line">    <span class="keyword">assign</span> DIG = ~DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分频</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            clkout &lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(cnt == (period&gt;&gt;<span class="number">1</span>)-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">                clkout &lt;= ~clkout;</span><br><span class="line">                cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cnt &lt;= cnt+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描计数</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clkout <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst)</span><br><span class="line">            scan_cnt &lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                scan_cnt &lt;= scan_cnt +<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(scan_cnt == <span class="number">3&#x27;d7</span>) scan_cnt &lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span>    </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//将输入转为对应位置的BCD码</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt, setT, envT) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">            <span class="number">1</span> : bcd = setT[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line">            <span class="number">2</span> : bcd = setT[<span class="number">7</span>:<span class="number">4</span>];</span><br><span class="line">            <span class="number">3</span> : bcd = setT[<span class="number">11</span>:<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">            <span class="number">5</span> : bcd = envT[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line">            <span class="number">6</span> : bcd = envT[<span class="number">7</span>:<span class="number">4</span>];</span><br><span class="line">            <span class="number">7</span> : bcd = envT[<span class="number">11</span>:<span class="number">8</span>];</span><br><span class="line">            <span class="keyword">default</span>: bcd = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//BCD码转输出字符</span></span><br><span class="line">    <span class="keyword">always</span> @ (bcd)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(bcd)</span><br><span class="line">            <span class="number">4&#x27;b0000</span>: seg_out = <span class="number">7&#x27;b0111111</span>;<span class="comment">//0</span></span><br><span class="line">            <span class="number">4&#x27;b0001</span>: seg_out = <span class="number">7&#x27;b0000110</span>;<span class="comment">//1</span></span><br><span class="line">            <span class="number">4&#x27;b0010</span>: seg_out = <span class="number">7&#x27;b1011011</span>;<span class="comment">//2</span></span><br><span class="line">            <span class="number">4&#x27;b0011</span>: seg_out = <span class="number">7&#x27;b1001111</span>;<span class="comment">//3                                 </span></span><br><span class="line">            <span class="number">4&#x27;b0100</span>: seg_out = <span class="number">7&#x27;b1100110</span>;<span class="comment">//4</span></span><br><span class="line">            <span class="number">4&#x27;b0101</span>: seg_out = <span class="number">7&#x27;b1101101</span>;<span class="comment">//5</span></span><br><span class="line">            <span class="number">4&#x27;b0110</span>: seg_out = <span class="number">7&#x27;b1111101</span>;<span class="comment">//6</span></span><br><span class="line">            <span class="number">4&#x27;b0111</span>: seg_out = <span class="number">7&#x27;b0100111</span>;<span class="comment">//7</span></span><br><span class="line">            <span class="number">4&#x27;b1000</span>: seg_out = <span class="number">7&#x27;b1111111</span>;<span class="comment">//8</span></span><br><span class="line">            <span class="number">4&#x27;b1001</span>: seg_out = <span class="number">7&#x27;b1101111</span>;<span class="comment">//9</span></span><br><span class="line">            <span class="keyword">default</span> :seg_out = <span class="number">7&#x27;b0000000</span>;<span class="comment">//全灭</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描 8选一</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt, on_off) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (on_off &amp;&amp; ifon_elec &amp;&amp; ifon_time) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">3&#x27;b000</span> : DIG_r = <span class="number">8&#x27;b0000_0001</span>;</span><br><span class="line">                <span class="number">3&#x27;b001</span> : DIG_r = <span class="number">8&#x27;b0000_0010</span>;</span><br><span class="line">                <span class="number">3&#x27;b010</span> : DIG_r = <span class="number">8&#x27;b0000_0100</span>;</span><br><span class="line">                <span class="number">3&#x27;b011</span> : DIG_r = <span class="number">8&#x27;b0000_1000</span>;</span><br><span class="line">                <span class="number">3&#x27;b100</span> : DIG_r = <span class="number">8&#x27;b0001_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b101</span> : DIG_r = <span class="number">8&#x27;b0010_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b110</span> : DIG_r = <span class="number">8&#x27;b0100_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b111</span> : DIG_r = <span class="number">8&#x27;b1000_0000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">3&#x27;b000</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;<span class="comment">//？</span></span><br><span class="line">                <span class="number">3&#x27;b001</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b010</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b011</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b100</span> : DIG_r = <span class="number">8&#x27;b0001_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b101</span> : DIG_r = <span class="number">8&#x27;b0010_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b110</span> : DIG_r = <span class="number">8&#x27;b0100_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b111</span> : DIG_r = <span class="number">8&#x27;b1000_0000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(DIG_r) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (DIG_r)</span><br><span class="line">            <span class="number">8&#x27;b0000_1000</span> : dot = <span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="number">8&#x27;b1000_0000</span> : dot = <span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">default</span>: dot = <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="电量显示模块"><a href="#电量显示模块" class="headerlink" title="电量显示模块"></a>电量显示模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> view_elec(</span><br><span class="line">    <span class="keyword">input</span> on_off,</span><br><span class="line">    <span class="keyword">input</span> rst,  <span class="comment">//复位</span></span><br><span class="line">    <span class="keyword">input</span> clk,  <span class="comment">//Y18</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">11</span>:<span class="number">0</span>] elec,  <span class="comment">//电量</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] DIG,  <span class="comment">//8个 扫描一个</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] Y    <span class="comment">//输出的内容</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> clkout;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] scan_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> period = <span class="number">200000</span>; <span class="comment">//500Hz</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] Y_r;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] bcd;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] seg_out;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> dot;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> Y = &#123;dot,(~Y_r[<span class="number">6</span>:<span class="number">0</span>])&#125;;</span><br><span class="line">    <span class="keyword">assign</span> DIG = ~DIG_r;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//分频</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            clkout &lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(cnt == (period&gt;&gt;<span class="number">1</span>) - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">                clkout &lt;= ~clkout;</span><br><span class="line">                cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cnt &lt;= cnt+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描计数</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clkout <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst)</span><br><span class="line">            scan_cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                scan_cnt &lt;= scan_cnt + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(scan_cnt == <span class="number">4&#x27;b1000</span>) scan_cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span>    </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//左侧三位 显示电量数字</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt, elec)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">5</span> : bcd = elec[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line">                <span class="number">6</span> : bcd = elec[<span class="number">7</span>:<span class="number">4</span>];</span><br><span class="line">                <span class="number">7</span> : bcd = elec[<span class="number">11</span>:<span class="number">8</span>];       </span><br><span class="line">            <span class="keyword">default</span>: bcd = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//BCD转数字 </span></span><br><span class="line">    <span class="comment">//default 理论上到达不了</span></span><br><span class="line">    <span class="keyword">always</span> @ (bcd) </span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(bcd)</span><br><span class="line">            <span class="number">4&#x27;b0000</span>: seg_out = <span class="number">7&#x27;b0111111</span>;<span class="comment">//0</span></span><br><span class="line">            <span class="number">4&#x27;b0001</span>: seg_out = <span class="number">7&#x27;b0000110</span>;<span class="comment">//1</span></span><br><span class="line">            <span class="number">4&#x27;b0010</span>: seg_out = <span class="number">7&#x27;b1011011</span>;<span class="comment">//2</span></span><br><span class="line">            <span class="number">4&#x27;b0011</span>: seg_out = <span class="number">7&#x27;b1001111</span>;<span class="comment">//3                                 </span></span><br><span class="line">            <span class="number">4&#x27;b0100</span>: seg_out = <span class="number">7&#x27;b1100110</span>;<span class="comment">//4</span></span><br><span class="line">            <span class="number">4&#x27;b0101</span>: seg_out = <span class="number">7&#x27;b1101101</span>;<span class="comment">//5</span></span><br><span class="line">            <span class="number">4&#x27;b0110</span>: seg_out = <span class="number">7&#x27;b1111101</span>;<span class="comment">//6</span></span><br><span class="line">            <span class="number">4&#x27;b0111</span>: seg_out = <span class="number">7&#x27;b0100111</span>;<span class="comment">//7</span></span><br><span class="line">            <span class="number">4&#x27;b1000</span>: seg_out = <span class="number">7&#x27;b1111111</span>;<span class="comment">//8</span></span><br><span class="line">            <span class="number">4&#x27;b1001</span>: seg_out = <span class="number">7&#x27;b1101111</span>;<span class="comment">//9</span></span><br><span class="line">            <span class="keyword">default</span> :seg_out = <span class="number">7&#x27;b0000000</span>;<span class="comment">//全灭</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描 8个显示选一个</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">3&#x27;b000</span> : DIG_r = <span class="number">8&#x27;b0000_0001</span>;</span><br><span class="line">                <span class="number">3&#x27;b001</span> : DIG_r = <span class="number">8&#x27;b0000_0010</span>;</span><br><span class="line">                <span class="number">3&#x27;b010</span> : DIG_r = <span class="number">8&#x27;b0000_0100</span>;</span><br><span class="line">                <span class="number">3&#x27;b011</span> : DIG_r = <span class="number">8&#x27;b0000_1000</span>;</span><br><span class="line">                <span class="number">3&#x27;b100</span> : DIG_r = <span class="number">8&#x27;b0001_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b101</span> : DIG_r = <span class="number">8&#x27;b0010_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b110</span> : DIG_r = <span class="number">8&#x27;b0100_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b111</span> : DIG_r = <span class="number">8&#x27;b1000_0000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">//总输出显示</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt, seg_out) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">0</span> : Y_r = <span class="number">7&#x27;b1110100</span>;<span class="comment">//h</span></span><br><span class="line">                <span class="number">1</span> : Y_r = <span class="number">7&#x27;b1000000</span>;<span class="comment">//-</span></span><br><span class="line">                <span class="number">2</span> : Y_r = <span class="number">7&#x27;b1101010</span>;<span class="comment">//w</span></span><br><span class="line">                <span class="number">3</span> : Y_r = <span class="number">7&#x27;b0000000</span>;</span><br><span class="line">                <span class="number">4</span> : Y_r = <span class="number">7&#x27;b0000000</span>;<span class="comment">//kong</span></span><br><span class="line">                <span class="number">5</span> : Y_r = seg_out;</span><br><span class="line">                <span class="number">6</span> : Y_r = seg_out;</span><br><span class="line">                <span class="number">7</span> : Y_r = seg_out;</span><br><span class="line">                <span class="keyword">default</span>: Y_r = <span class="number">7&#x27;b0000000</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(DIG_r) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (DIG_r)</span><br><span class="line">            <span class="number">8&#x27;b1000_0000</span> : dot = <span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">default</span>: dot = <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="模式显示模块"><a href="#模式显示模块" class="headerlink" title="模式显示模块"></a>模式显示模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> view_mode(</span><br><span class="line">    <span class="keyword">input</span> on_off,</span><br><span class="line">    <span class="keyword">input</span> rst,  <span class="comment">//复位</span></span><br><span class="line">    <span class="keyword">input</span> clk,  <span class="comment">//Y18</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] mode, <span class="comment">//模式</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] DIG,  <span class="comment">//8个 扫描一个</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] Y    <span class="comment">//输出的内容</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> clkout;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] scan_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> period = <span class="number">200000</span>; <span class="comment">//500Hz</span></span><br><span class="line">    <span class="comment">//parameter period = 2500000 // 40Hz </span></span><br><span class="line">    <span class="comment">//parameter period = 5000000;</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] Y_r;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] char3;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] char2;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] char1;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] char0;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> Y = &#123;<span class="number">1&#x27;b1</span>,(~Y_r[<span class="number">6</span>:<span class="number">0</span>])&#125;;</span><br><span class="line">    <span class="keyword">assign</span> DIG = ~DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分频</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            clkout &lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(cnt == (period&gt;&gt;<span class="number">1</span>)-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">                clkout &lt;= ~clkout;</span><br><span class="line">                cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cnt &lt;= cnt+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描计数</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clkout <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst)</span><br><span class="line">            scan_cnt &lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>(scan_cnt == <span class="number">3&#x27;d7</span>) scan_cnt &lt;=<span class="number">0</span>;</span><br><span class="line">                scan_cnt &lt;= scan_cnt +<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span>    </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//右侧4位输出内容</span></span><br><span class="line">    <span class="keyword">always</span> @ (mode)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span>(mode) <span class="comment">//01 wind 10 cool 11 hot</span></span><br><span class="line">                <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                    char0 = <span class="number">7&#x27;b0000000</span>;</span><br><span class="line">                    char1 = <span class="number">7&#x27;b1010000</span>;<span class="comment">//r</span></span><br><span class="line">                    char2 = <span class="number">7&#x27;b0000100</span>;<span class="comment">//i</span></span><br><span class="line">                    char3 = <span class="number">7&#x27;b1110111</span>;<span class="comment">//a</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                    char0 = <span class="number">7&#x27;b0000110</span>;<span class="comment">//l</span></span><br><span class="line">                    char1 = <span class="number">7&#x27;b1011100</span>;<span class="comment">//o</span></span><br><span class="line">                    char2 = <span class="number">7&#x27;b1011100</span>;<span class="comment">//o</span></span><br><span class="line">                    char3 = <span class="number">7&#x27;b1011000</span>;<span class="comment">//c</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                    char0 = <span class="number">7&#x27;b0000000</span>;<span class="comment">//kong</span></span><br><span class="line">                    char1 = <span class="number">7&#x27;b1111000</span>;<span class="comment">//t</span></span><br><span class="line">                    char2 = <span class="number">7&#x27;b1011100</span>;<span class="comment">//o</span></span><br><span class="line">                    char3 = <span class="number">7&#x27;b1110100</span>;<span class="comment">//h</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">default</span></span><br><span class="line">                    <span class="keyword">begin</span></span><br><span class="line">                        char0 = <span class="number">7&#x27;b0000000</span>;<span class="comment">//kong</span></span><br><span class="line">                        char1 = <span class="number">7&#x27;b0000000</span>;<span class="comment">//kong</span></span><br><span class="line">                        char2 = <span class="number">7&#x27;b0000000</span>;<span class="comment">//kong</span></span><br><span class="line">                        char3 = <span class="number">7&#x27;b0000000</span>;<span class="comment">//kong</span></span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描到的位置</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">3&#x27;b000</span> : DIG_r = <span class="number">8&#x27;b0000_0001</span>;</span><br><span class="line">                <span class="number">3&#x27;b001</span> : DIG_r = <span class="number">8&#x27;b0000_0010</span>;</span><br><span class="line">                <span class="number">3&#x27;b010</span> : DIG_r = <span class="number">8&#x27;b0000_0100</span>;</span><br><span class="line">                <span class="number">3&#x27;b011</span> : DIG_r = <span class="number">8&#x27;b0000_1000</span>;</span><br><span class="line">                <span class="number">3&#x27;b100</span> : DIG_r = <span class="number">8&#x27;b0001_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b101</span> : DIG_r = <span class="number">8&#x27;b0010_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b110</span> : DIG_r = <span class="number">8&#x27;b0100_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b111</span> : DIG_r = <span class="number">8&#x27;b1000_0000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描输出的内容</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt, char0, char1, char2, char3) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">            <span class="number">7</span> : Y_r = <span class="number">7&#x27;b1010101</span>;<span class="comment">//m</span></span><br><span class="line">            <span class="number">6</span> : Y_r = <span class="number">7&#x27;b1011100</span>;<span class="comment">//o</span></span><br><span class="line">            <span class="number">5</span> : Y_r = <span class="number">7&#x27;b1011110</span>;<span class="comment">//d</span></span><br><span class="line">            <span class="number">4</span> : Y_r = <span class="number">7&#x27;b1111001</span>;<span class="comment">//e</span></span><br><span class="line">            <span class="number">0</span> : Y_r = char0;</span><br><span class="line">            <span class="number">1</span> : Y_r = char1;</span><br><span class="line">            <span class="number">2</span> : Y_r = char2;</span><br><span class="line">            <span class="number">3</span> : Y_r = char3;</span><br><span class="line">            <span class="keyword">default</span>: Y_r = <span class="number">7&#x27;b0000000</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="充电显示模块"><a href="#充电显示模块" class="headerlink" title="充电显示模块"></a>充电显示模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> view_charge(</span><br><span class="line">    <span class="keyword">input</span> on_off, ifon_elec, rst, clk,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">11</span>:<span class="number">0</span>] elec, <span class="comment">// 电量</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">11</span>:<span class="number">0</span>] charge, <span class="comment">// 充电量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] DIG,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] Y</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> clkout;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] scan_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> period = <span class="number">200000</span>; <span class="comment">//500Hz</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] bcd;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] seg_out;</span><br><span class="line">    <span class="keyword">reg</span> dot;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> Y = &#123;dot,(~seg_out[<span class="number">6</span>:<span class="number">0</span>])&#125;;</span><br><span class="line">    <span class="keyword">assign</span> DIG = ~DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分频</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            clkout &lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(cnt == (period&gt;&gt;<span class="number">1</span>)-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">                clkout &lt;= ~clkout;</span><br><span class="line">                cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cnt &lt;= cnt+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描计数</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clkout <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst)</span><br><span class="line">            scan_cnt &lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                scan_cnt &lt;= scan_cnt +<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(scan_cnt == <span class="number">3&#x27;d7</span>) scan_cnt &lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span>    </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//将输入转为对应位置的BCD码</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">1</span> : bcd = charge[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line">                <span class="number">2</span> : bcd = charge[<span class="number">7</span>:<span class="number">4</span>];</span><br><span class="line">                <span class="number">3</span> : bcd = charge[<span class="number">11</span>:<span class="number">8</span>];</span><br><span class="line">                <span class="number">5</span> : bcd = elec[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line">                <span class="number">6</span> : bcd = elec[<span class="number">7</span>:<span class="number">4</span>];</span><br><span class="line">                <span class="number">7</span> : bcd = elec[<span class="number">11</span>:<span class="number">8</span>];</span><br><span class="line">                <span class="keyword">default</span>: bcd = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//BCD码转输出字符</span></span><br><span class="line">    <span class="keyword">always</span> @ (bcd)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(bcd)</span><br><span class="line">            <span class="number">4&#x27;b0000</span>: seg_out = <span class="number">7&#x27;b0111111</span>;<span class="comment">//0</span></span><br><span class="line">            <span class="number">4&#x27;b0001</span>: seg_out = <span class="number">7&#x27;b0000110</span>;<span class="comment">//1</span></span><br><span class="line">            <span class="number">4&#x27;b0010</span>: seg_out = <span class="number">7&#x27;b1011011</span>;<span class="comment">//2</span></span><br><span class="line">            <span class="number">4&#x27;b0011</span>: seg_out = <span class="number">7&#x27;b1001111</span>;<span class="comment">//3                                 </span></span><br><span class="line">            <span class="number">4&#x27;b0100</span>: seg_out = <span class="number">7&#x27;b1100110</span>;<span class="comment">//4</span></span><br><span class="line">            <span class="number">4&#x27;b0101</span>: seg_out = <span class="number">7&#x27;b1101101</span>;<span class="comment">//5</span></span><br><span class="line">            <span class="number">4&#x27;b0110</span>: seg_out = <span class="number">7&#x27;b1111101</span>;<span class="comment">//6</span></span><br><span class="line">            <span class="number">4&#x27;b0111</span>: seg_out = <span class="number">7&#x27;b0100111</span>;<span class="comment">//7</span></span><br><span class="line">            <span class="number">4&#x27;b1000</span>: seg_out = <span class="number">7&#x27;b1111111</span>;<span class="comment">//8</span></span><br><span class="line">            <span class="number">4&#x27;b1001</span>: seg_out = <span class="number">7&#x27;b1101111</span>;<span class="comment">//9</span></span><br><span class="line">            <span class="keyword">default</span> :seg_out = <span class="number">7&#x27;b0000000</span>;<span class="comment">//全灭</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描 8选一</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!(on_off &amp;&amp; ifon_elec)) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">3&#x27;b000</span> : DIG_r = <span class="number">8&#x27;b0000_0001</span>;</span><br><span class="line">                <span class="number">3&#x27;b001</span> : DIG_r = <span class="number">8&#x27;b0000_0010</span>;</span><br><span class="line">                <span class="number">3&#x27;b010</span> : DIG_r = <span class="number">8&#x27;b0000_0100</span>;</span><br><span class="line">                <span class="number">3&#x27;b011</span> : DIG_r = <span class="number">8&#x27;b0000_1000</span>;</span><br><span class="line">                <span class="number">3&#x27;b100</span> : DIG_r = <span class="number">8&#x27;b0001_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b101</span> : DIG_r = <span class="number">8&#x27;b0010_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b110</span> : DIG_r = <span class="number">8&#x27;b0100_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b111</span> : DIG_r = <span class="number">8&#x27;b1000_0000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">3&#x27;b000</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b001</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b010</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b011</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b100</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b101</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b110</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b111</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(DIG_r) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (DIG_r)</span><br><span class="line">            <span class="number">8&#x27;b0000_1000</span> : dot = <span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="number">8&#x27;b1000_0000</span> : dot = <span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">default</span>: dot = <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="倒计时显示模块"><a href="#倒计时显示模块" class="headerlink" title="倒计时显示模块"></a>倒计时显示模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> view_time2(</span><br><span class="line">    <span class="keyword">input</span> on_off, ifon_elec, ifon_time, rst, clk,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">11</span>:<span class="number">0</span>] settime,<span class="comment">//设定时间 左侧显示</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">11</span>:<span class="number">0</span>] curtime,<span class="comment">//当前剩余时间 右侧显示</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] DIG,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] Y</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> clkout;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] scan_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> period = <span class="number">200000</span>; <span class="comment">//500Hz</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] bcd;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] seg_out;</span><br><span class="line">    <span class="keyword">reg</span> dot;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> Y = &#123;dot,(~seg_out[<span class="number">6</span>:<span class="number">0</span>])&#125;;</span><br><span class="line">    <span class="keyword">assign</span> DIG = ~DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分频</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            clkout &lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(cnt == (period&gt;&gt;<span class="number">1</span>)-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">                clkout &lt;= ~clkout;</span><br><span class="line">                cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cnt &lt;= cnt+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描计数</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clkout <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst)</span><br><span class="line">            scan_cnt &lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                scan_cnt &lt;= scan_cnt +<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(scan_cnt == <span class="number">3&#x27;d7</span>) scan_cnt &lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span>    </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//将输入转为对应位置的BCD码</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">1</span> : bcd = curtime[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line">                <span class="number">2</span> : bcd = curtime[<span class="number">7</span>:<span class="number">4</span>];</span><br><span class="line">                <span class="number">3</span> : bcd = curtime[<span class="number">11</span>:<span class="number">8</span>];</span><br><span class="line">                <span class="number">5</span> : bcd = settime[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line">                <span class="number">6</span> : bcd = settime[<span class="number">7</span>:<span class="number">4</span>];</span><br><span class="line">                <span class="number">7</span> : bcd = settime[<span class="number">11</span>:<span class="number">8</span>];</span><br><span class="line">                <span class="keyword">default</span>: bcd = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//BCD码转输出字符</span></span><br><span class="line">    <span class="keyword">always</span> @ (bcd)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(bcd)</span><br><span class="line">            <span class="number">4&#x27;b0000</span>: seg_out = <span class="number">7&#x27;b0111111</span>;<span class="comment">//0</span></span><br><span class="line">            <span class="number">4&#x27;b0001</span>: seg_out = <span class="number">7&#x27;b0000110</span>;<span class="comment">//1</span></span><br><span class="line">            <span class="number">4&#x27;b0010</span>: seg_out = <span class="number">7&#x27;b1011011</span>;<span class="comment">//2</span></span><br><span class="line">            <span class="number">4&#x27;b0011</span>: seg_out = <span class="number">7&#x27;b1001111</span>;<span class="comment">//3                                 </span></span><br><span class="line">            <span class="number">4&#x27;b0100</span>: seg_out = <span class="number">7&#x27;b1100110</span>;<span class="comment">//4</span></span><br><span class="line">            <span class="number">4&#x27;b0101</span>: seg_out = <span class="number">7&#x27;b1101101</span>;<span class="comment">//5</span></span><br><span class="line">            <span class="number">4&#x27;b0110</span>: seg_out = <span class="number">7&#x27;b1111101</span>;<span class="comment">//6</span></span><br><span class="line">            <span class="number">4&#x27;b0111</span>: seg_out = <span class="number">7&#x27;b0100111</span>;<span class="comment">//7</span></span><br><span class="line">            <span class="number">4&#x27;b1000</span>: seg_out = <span class="number">7&#x27;b1111111</span>;<span class="comment">//8</span></span><br><span class="line">            <span class="number">4&#x27;b1001</span>: seg_out = <span class="number">7&#x27;b1101111</span>;<span class="comment">//9</span></span><br><span class="line">            <span class="keyword">default</span> :seg_out = <span class="number">7&#x27;b0000000</span>;<span class="comment">//全灭</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描 8选一</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (on_off &amp;&amp; ifon_elec &amp;&amp; ifon_time) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">3&#x27;b000</span> : DIG_r = <span class="number">8&#x27;b0000_0001</span>;</span><br><span class="line">                <span class="number">3&#x27;b001</span> : DIG_r = <span class="number">8&#x27;b0000_0010</span>;</span><br><span class="line">                <span class="number">3&#x27;b010</span> : DIG_r = <span class="number">8&#x27;b0000_0100</span>;</span><br><span class="line">                <span class="number">3&#x27;b011</span> : DIG_r = <span class="number">8&#x27;b0000_1000</span>;</span><br><span class="line">                <span class="number">3&#x27;b100</span> : DIG_r = <span class="number">8&#x27;b0001_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b101</span> : DIG_r = <span class="number">8&#x27;b0010_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b110</span> : DIG_r = <span class="number">8&#x27;b0100_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b111</span> : DIG_r = <span class="number">8&#x27;b1000_0000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">3&#x27;b000</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b001</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b010</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b011</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b100</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b101</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b110</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b111</span> : DIG_r = <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(DIG_r) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (DIG_r)</span><br><span class="line">            <span class="keyword">default</span>: dot = <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="显示历史充值记录"><a href="#显示历史充值记录" class="headerlink" title="显示历史充值记录"></a>显示历史充值记录</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> view_chargehistory(</span><br><span class="line">    <span class="keyword">input</span> rst, clk,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">11</span>:<span class="number">0</span>] chargeInfo, <span class="comment">// 充电信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] DIG,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] Y</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> clkout;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] scan_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> period = <span class="number">200000</span>; <span class="comment">//500Hz</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] bcd;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] seg_out;</span><br><span class="line">    <span class="keyword">reg</span> dot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> Y = &#123;dot,(~seg_out[<span class="number">6</span>:<span class="number">0</span>])&#125;;</span><br><span class="line">    <span class="keyword">assign</span> DIG = ~DIG_r;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分频</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            clkout &lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(cnt == (period&gt;&gt;<span class="number">1</span>)-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">                clkout &lt;= ~clkout;</span><br><span class="line">                cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cnt &lt;= cnt+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描计数</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clkout <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst)</span><br><span class="line">            scan_cnt &lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                scan_cnt &lt;= scan_cnt +<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(scan_cnt == <span class="number">3&#x27;d7</span>) scan_cnt &lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span>    </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//将输入转为对应位置的BCD码</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">            <span class="number">5</span> : bcd = chargeInfo[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line">            <span class="number">6</span> : bcd = chargeInfo[<span class="number">7</span>:<span class="number">4</span>];</span><br><span class="line">            <span class="number">7</span> : bcd = chargeInfo[<span class="number">11</span>:<span class="number">8</span>];</span><br><span class="line">            <span class="keyword">default</span>: bcd = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//BCD码转输出字符</span></span><br><span class="line">    <span class="keyword">always</span> @ (bcd)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(bcd)</span><br><span class="line">            <span class="number">4&#x27;b0000</span>: seg_out = <span class="number">7&#x27;b0111111</span>;<span class="comment">//0</span></span><br><span class="line">            <span class="number">4&#x27;b0001</span>: seg_out = <span class="number">7&#x27;b0000110</span>;<span class="comment">//1</span></span><br><span class="line">            <span class="number">4&#x27;b0010</span>: seg_out = <span class="number">7&#x27;b1011011</span>;<span class="comment">//2</span></span><br><span class="line">            <span class="number">4&#x27;b0011</span>: seg_out = <span class="number">7&#x27;b1001111</span>;<span class="comment">//3                                 </span></span><br><span class="line">            <span class="number">4&#x27;b0100</span>: seg_out = <span class="number">7&#x27;b1100110</span>;<span class="comment">//4</span></span><br><span class="line">            <span class="number">4&#x27;b0101</span>: seg_out = <span class="number">7&#x27;b1101101</span>;<span class="comment">//5</span></span><br><span class="line">            <span class="number">4&#x27;b0110</span>: seg_out = <span class="number">7&#x27;b1111101</span>;<span class="comment">//6</span></span><br><span class="line">            <span class="number">4&#x27;b0111</span>: seg_out = <span class="number">7&#x27;b0100111</span>;<span class="comment">//7</span></span><br><span class="line">            <span class="number">4&#x27;b1000</span>: seg_out = <span class="number">7&#x27;b1111111</span>;<span class="comment">//8</span></span><br><span class="line">            <span class="number">4&#x27;b1001</span>: seg_out = <span class="number">7&#x27;b1101111</span>;<span class="comment">//9</span></span><br><span class="line">            <span class="keyword">default</span> :seg_out = <span class="number">7&#x27;b0000000</span>;<span class="comment">//全灭</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//扫描 8选一</span></span><br><span class="line">    <span class="keyword">always</span> @ (scan_cnt) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (scan_cnt)</span><br><span class="line">                <span class="number">3&#x27;b000</span> : DIG_r = <span class="number">8&#x27;b0000_0001</span>;</span><br><span class="line">                <span class="number">3&#x27;b001</span> : DIG_r = <span class="number">8&#x27;b0000_0010</span>;</span><br><span class="line">                <span class="number">3&#x27;b010</span> : DIG_r = <span class="number">8&#x27;b0000_0100</span>;</span><br><span class="line">                <span class="number">3&#x27;b011</span> : DIG_r = <span class="number">8&#x27;b0000_1000</span>;</span><br><span class="line">                <span class="number">3&#x27;b100</span> : DIG_r = <span class="number">8&#x27;b0001_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b101</span> : DIG_r = <span class="number">8&#x27;b0010_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b110</span> : DIG_r = <span class="number">8&#x27;b0100_0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b111</span> : DIG_r = <span class="number">8&#x27;b1000_0000</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(DIG_r) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (DIG_r)</span><br><span class="line">            <span class="comment">//8&#x27;b0000_1000 : dot = 1&#x27;b0;</span></span><br><span class="line">            <span class="number">8&#x27;b1000_0000</span> : dot = <span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">default</span>: dot = <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="控制顶层"><a href="#控制顶层" class="headerlink" title="控制顶层"></a>控制顶层</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> controller_top(</span><br><span class="line">    <span class="comment">// 拨码开关(开关机, 1为开机, 0为关机), 板上时钟, 小键盘(2个4bit行和列), </span></span><br><span class="line">    <span class="comment">//五个小按钮(上下左右中), 当前状态(01温度, 10电量, 11模式)</span></span><br><span class="line">    <span class="keyword">input</span> on_off, rst, lookup, clock_Y18,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] row,</span><br><span class="line">    <span class="keyword">input</span> up, down, left, right, middle, mid,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] select,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] mode, <span class="comment">// 模式</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">11</span>:<span class="number">0</span>] innertemper, <span class="comment">// 设定温度</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">11</span>:<span class="number">0</span>] envirtemper, <span class="comment">// 环境温度</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">11</span>:<span class="number">0</span>] power, <span class="comment">// 电量</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] col, <span class="comment">// 小键盘列输出信息</span></span><br><span class="line">    <span class="keyword">output</span> ifon, <span class="comment">// 开关状态(电量耗尽)</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">11</span>:<span class="number">0</span>] chargevalue, <span class="comment">// 充电量</span></span><br><span class="line">    <span class="keyword">output</span> input_end, <span class="comment">// 充电结束</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">11</span>:<span class="number">0</span>] count_time, <span class="comment">// 设定关机时间</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">11</span>:<span class="number">0</span>] time_remain, <span class="comment">// 剩余时间</span></span><br><span class="line">    <span class="keyword">output</span> ifon_count_time, <span class="comment">// 是否关机(定时关机)</span></span><br><span class="line">    <span class="keyword">output</span> beep_out, <span class="comment">// 蜂鸣器</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">11</span>:<span class="number">0</span>] chargeInfo <span class="comment">// 点亮查询信息</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> clk;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] mod;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>] bin_inner; <span class="comment">// 设定温度</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>] bin_envir; <span class="comment">// 环境温度</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>] bin_power; <span class="comment">// 电量</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>] chargeElectricity; <span class="comment">// 充电量</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>] bin_count_time; <span class="comment">//设置倒计时</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>] bin_time_remain; <span class="comment">// 倒计时</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>] bin_chargeInfo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] numbers;<span class="comment">//小键盘输出</span></span><br><span class="line">    <span class="keyword">wire</span> ifon_elec; <span class="comment">// 电量监控开关</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> mode = mod;</span><br><span class="line">    <span class="keyword">assign</span> ifon = ifon_elec;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分频器生成一秒时钟信号</span></span><br><span class="line">    div_frequency modeclk(clock_Y18, rst, clk);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置环境温度和模式</span></span><br><span class="line">    envirtemper_mode setenvirtemper(on_off, ifon_elec, clock_Y18, clk, rst, up, down, bin_inner, select, bin_envir, mod);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设定温度</span></span><br><span class="line">    coretemper settemper(on_off, ifon_elec, clock_Y18, up, down, rst, select, bin_inner);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 电量</span></span><br><span class="line">    corepower setpower(clock_Y18, on_off, rst, mod, chargeElectricity, input_end, bin_power, ifon_elec);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 小键盘</span></span><br><span class="line">    keyboard_core readkeyboard(clock_Y18,rst,row,col,numbers);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 充电</span></span><br><span class="line">    charge modecharge(clock_Y18, rst, mid, numbers, on_off, ifon_elec, chargeElectricity, input_end);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//倒计时的时间</span></span><br><span class="line">    countdown_input givetime(clock_Y18, rst, mid, numbers, on_off, ifon_elec, select, bin_count_time, input_time_end);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//倒计时模块</span></span><br><span class="line">    auto_off_top count_time_to_close(on_off, clock_Y18, rst, input_time_end, bin_count_time, ifon_count_time, beep_out, bin_time_remain);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//充值记录模块</span></span><br><span class="line">    memory memory_inst(lookup,rst,mid,chargeElectricity,clk,input_end,left,right,middle,bin_chargeInfo);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 二进制转BCD</span></span><br><span class="line">    Bin_BCD trans_inner(bin_inner, innertemper);</span><br><span class="line">    Bin_BCD trans_envir(bin_envir, envirtemper);</span><br><span class="line">    Bin_BCD trans_power(bin_power, power);</span><br><span class="line">    Bin_BCD trans_charge(chargeElectricity, chargevalue);</span><br><span class="line">    Bin_BCD trans_count_time(bin_time_remain,time_remain);</span><br><span class="line">    Bin_BCD trans_set_count_time(bin_count_time, count_time);</span><br><span class="line">    Bin_BCD trans_chargeinfo(bin_chargeInfo, chargeInfo);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="环境温度模块"><a href="#环境温度模块" class="headerlink" title="环境温度模块"></a>环境温度模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> envirtemper_mode(</span><br><span class="line">    <span class="keyword">input</span> on_off, ifon_elec, clock_Y18, clk, rst, up, down, [<span class="number">9</span>:<span class="number">0</span>] innertemper, [<span class="number">1</span>:<span class="number">0</span>] select, <span class="comment">// 1s的时钟信号, 输入端触发信号, 复位信号(开机时自动复位或者设置成按下reset键复位)</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">9</span>:<span class="number">0</span>]temperature, [<span class="number">1</span>:<span class="number">0</span>]mode <span class="comment">// 10bit位表示20.0~30.0的温度,包含小数点, mode:2bit位表示模式, 00默认加一为01, 01显示air, 10显示cold, 11显示hot</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] temper;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] mod; <span class="comment">// 记录mode变化并传给传出参数mode</span></span><br><span class="line">    <span class="keyword">reg</span> changemod;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> temperature = temper + <span class="number">8&#x27;b11001000</span>; <span class="comment">// temper+20.0</span></span><br><span class="line">    <span class="keyword">assign</span> mode = mod;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">negedge</span> rst) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (~rst) <span class="keyword">begin</span></span><br><span class="line">            temper &lt;= <span class="number">7&#x27;b0101000</span>; <span class="comment">// 复位为24.0</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (mode == <span class="number">2&#x27;b10</span>) <span class="keyword">begin</span> <span class="comment">// 制冷模式下环境温度较高, 则环境温度每一秒减一</span></span><br><span class="line">            <span class="keyword">if</span> (temperature &gt; innertemper) <span class="keyword">begin</span></span><br><span class="line">                temper &lt;= temper - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (mode == <span class="number">2&#x27;b11</span>) <span class="keyword">begin</span> <span class="comment">// 制热模式下环境温度较低, 则环境温度每一秒加一</span></span><br><span class="line">            <span class="keyword">if</span> (temperature &lt; innertemper) <span class="keyword">begin</span></span><br><span class="line">                temper &lt;= temper + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模式转换</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clock_Y18, <span class="keyword">negedge</span> rst) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (~rst) <span class="keyword">begin</span></span><br><span class="line">            mod &lt;= <span class="number">2&#x27;b01</span>;</span><br><span class="line">            changemod &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (select == <span class="number">2&#x27;b11</span> &amp;&amp; on_off &amp;&amp; ifon_elec) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (up) <span class="keyword">begin</span></span><br><span class="line">                mod &lt;= (mod + <span class="number">1</span>) == <span class="number">3&#x27;b100</span> ? <span class="number">2&#x27;b01</span> : (mod + <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (temperature != innertemper) <span class="keyword">begin</span></span><br><span class="line">                    changemod &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (down) <span class="keyword">begin</span></span><br><span class="line">                mod &lt;= (mod - <span class="number">1</span>) == <span class="number">2&#x27;b00</span> ? <span class="number">2&#x27;b11</span> : (mod - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (temperature != innertemper) <span class="keyword">begin</span></span><br><span class="line">                    changemod &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(temperature == innertemper &amp;&amp; changemod) <span class="keyword">begin</span></span><br><span class="line">                mod &lt;= <span class="number">2&#x27;b01</span>;</span><br><span class="line">                changemod &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(!(on_off &amp;&amp; ifon_elec)) <span class="keyword">begin</span></span><br><span class="line">            mod &lt;= <span class="number">2&#x27;b01</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="设定温度模块"><a href="#设定温度模块" class="headerlink" title="设定温度模块"></a>设定温度模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> coretemper(</span><br><span class="line">    <span class="comment">// 输入端触发信号, 复位信号(开机时自动复位或者设置成按下reset键复位), 判断按上下键是否加减</span></span><br><span class="line">    <span class="keyword">input</span> on_off, ifon_elec, clock_Y18, increase, decrease, rst, [<span class="number">1</span>:<span class="number">0</span>] select,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">9</span>:<span class="number">0</span>]temperature <span class="comment">// 10bit位表示20.0~30.0的温度,包含小数点</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] temper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> temperature = temper + <span class="number">8&#x27;b11001000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clock_Y18, <span class="keyword">negedge</span> rst) <span class="keyword">begin</span> <span class="comment">// increase信号上升沿, 温度加1</span></span><br><span class="line">        <span class="keyword">if</span> (~rst) <span class="keyword">begin</span> <span class="comment">// 复位</span></span><br><span class="line">            temper &lt;= <span class="number">7&#x27;b0110010</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(on_off &amp;&amp; ifon_elec) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (increase &amp;&amp; temper &lt; <span class="number">7&#x27;b1100100</span> &amp;&amp; select == <span class="number">2&#x27;b01</span>) <span class="keyword">begin</span> <span class="comment">// 如果是温度合法, 则加一</span></span><br><span class="line">                temper &lt;= temper + <span class="number">4&#x27;b1010</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (decrease &amp;&amp; temper &gt; <span class="number">7&#x27;b0000000</span> &amp;&amp; select == <span class="number">2&#x27;b01</span>) <span class="keyword">begin</span>  <span class="comment">// 如果是温度合法, 则减一</span></span><br><span class="line">                temper &lt;= temper - <span class="number">4&#x27;b1010</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="电量模块"><a href="#电量模块" class="headerlink" title="电量模块"></a>电量模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> corepower(</span><br><span class="line">    <span class="comment">// 时钟用于电量每秒的下降,on_off,1开机，0关机 mode用于模式的判定,01送风 10制冷 11制热</span></span><br><span class="line">    <span class="comment">//rst为初始化复位, tik为进入充值状态的触发，10位chargeElectricity表示充值的电量,input_end=1表示输入结束</span></span><br><span class="line">    <span class="keyword">input</span> clock_Y18, on_off, rst,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] mode,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>]chargeElectricity,</span><br><span class="line">    <span class="keyword">input</span> input_end,</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] power, <span class="comment">// 10位电量值, 0~1000</span></span><br><span class="line">    <span class="keyword">output</span> ifon <span class="comment">// 电量为0自动关机(1&#x27;b0)</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] record1second;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] record2second;</span><br><span class="line">    <span class="keyword">reg</span> on;</span><br><span class="line">    <span class="keyword">reg</span> ifinput; <span class="comment">// 锁定输入</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> ifon = on;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clock_Y18, <span class="keyword">negedge</span> rst) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst) <span class="keyword">begin</span> <span class="comment">// 复位</span></span><br><span class="line">            power &lt;= <span class="number">10&#x27;d100</span>;</span><br><span class="line">            record1second &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            record2second &lt;= <span class="number">0</span>;</span><br><span class="line">            on &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">            ifinput &lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (on_off &amp;&amp; on) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (mode == <span class="number">2&#x27;b10</span> || mode == <span class="number">2&#x27;b11</span>) <span class="keyword">begin</span> <span class="comment">// 制冷制热, 每1秒电量降1.0</span></span><br><span class="line">                <span class="keyword">if</span> (record1second == <span class="number">100000000</span>) <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (power &lt; <span class="number">10</span>) <span class="keyword">begin</span></span><br><span class="line">                        power &lt;= <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                        power &lt;= power - <span class="number">10&#x27;d10</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    record1second &lt;= <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    record1second &lt;= record1second + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (mode == <span class="number">2&#x27;b01</span>) <span class="keyword">begin</span> <span class="comment">// 送风, 每两秒电量降0.5</span></span><br><span class="line">                <span class="keyword">if</span> (record2second == <span class="number">200000000</span>) <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (power &lt; <span class="number">5</span>) <span class="keyword">begin</span></span><br><span class="line">                        power &lt;= <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                        power &lt;= power - <span class="number">10&#x27;d5</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    record2second &lt;= <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    record2second &lt;= record2second + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (power == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                on &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                on &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (input_end == <span class="number">1</span> &amp;&amp; ifinput) <span class="keyword">begin</span> <span class="comment">// 位于关机模式且输入已经结束, 充电环节</span></span><br><span class="line">                <span class="keyword">if</span> (power + chargeElectricity &gt; <span class="number">10&#x27;d999</span>) <span class="keyword">begin</span> <span class="comment">//若当前电量加充入电量大于999，则将电量设置为999</span></span><br><span class="line">                    power &lt;= <span class="number">10&#x27;d999</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span> <span class="comment">//否则 当前电量加上充入电量</span></span><br><span class="line">                    power &lt;= power + chargeElectricity;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                ifinput &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (input_end == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                ifinput &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!on_off &amp;&amp; power != <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                record1second &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">                record2second &lt;= <span class="number">0</span>;</span><br><span class="line">                on &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="小键盘模块"><a href="#小键盘模块" class="headerlink" title="小键盘模块"></a>小键盘模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> kenboard_core(</span><br><span class="line">    <span class="keyword">input</span> clk, rst,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] row,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] col,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] keys <span class="comment">// 输出小键盘对应位置信息</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> NO_SCAN = <span class="number">4&#x27;d0</span>;<span class="comment">//表示未扫描的状态</span></span><br><span class="line">    <span class="keyword">parameter</span> SCANING = <span class="number">4&#x27;d1</span>;<span class="comment">//表示扫描的状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">15</span>:<span class="number">0</span>] data;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] data_out;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">2</span>:<span class="number">0</span>] count; <span class="comment">// 当按键在数个时钟周期中都处于按下的状态，则认为这是一次有效的输入</span></span><br><span class="line"></span><br><span class="line">    keyboard_map key_mapping_inst(data_out, keys);<span class="comment">//将生成的行列坐标信号映射成输出所需要的信号</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> data_out=data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (rst) <span class="keyword">begin</span><span class="comment">//复位</span></span><br><span class="line">            col &lt;= <span class="number">4&#x27;b1111</span>;</span><br><span class="line">            state &lt;= NO_SCAN;</span><br><span class="line">            data &lt;= <span class="number">16&#x27;hFFFF</span>;</span><br><span class="line">            count &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (state)</span><br><span class="line">                NO_SCAN: <span class="keyword">begin</span><span class="comment">//若处于未扫描的状态，则进入扫描状态，开始扫描col0</span></span><br><span class="line">                    state &lt;= SCANING;</span><br><span class="line">                    col &lt;= <span class="number">4&#x27;b1110</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                SCANING: <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">case</span>(col)</span><br><span class="line"></span><br><span class="line">                        <span class="number">4&#x27;b1110</span>: <span class="keyword">begin</span><span class="comment">//扫描col0</span></span><br><span class="line">                            <span class="keyword">if</span>(count == <span class="number">7</span>) <span class="keyword">begin</span></span><br><span class="line">                                data[<span class="number">3</span>:<span class="number">0</span>] &lt;= row;</span><br><span class="line">                                col &lt;= <span class="number">4&#x27;b0111</span>;</span><br><span class="line">                                count &lt;= <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">else</span> count &lt;= count + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                        <span class="number">4&#x27;b0111</span>: <span class="keyword">begin</span><span class="comment">//扫描col3</span></span><br><span class="line">                            <span class="keyword">if</span>(count == <span class="number">7</span>) <span class="keyword">begin</span></span><br><span class="line">                                data[<span class="number">15</span>:<span class="number">12</span>] &lt;= row;</span><br><span class="line">                                col &lt;= <span class="number">4&#x27;b1011</span>;</span><br><span class="line">                                count &lt;= <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">else</span> count &lt;= count + <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                        <span class="number">4&#x27;b1011</span>: <span class="keyword">begin</span><span class="comment">//扫描col2</span></span><br><span class="line">                            <span class="keyword">if</span>(count == <span class="number">7</span>) <span class="keyword">begin</span></span><br><span class="line">                                data[<span class="number">11</span>:<span class="number">8</span>] &lt;= row;</span><br><span class="line">                                col &lt;= <span class="number">4&#x27;b1101</span>;</span><br><span class="line">                                count &lt;= <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">else</span> count &lt;= count + <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="number">4&#x27;b1101</span>: <span class="keyword">begin</span><span class="comment">//扫描col1</span></span><br><span class="line">                            <span class="keyword">if</span>(count == <span class="number">7</span>) <span class="keyword">begin</span></span><br><span class="line">                                data[<span class="number">7</span>:<span class="number">4</span>] &lt;= row;</span><br><span class="line">                                col &lt;= <span class="number">4&#x27;b1110</span>;</span><br><span class="line">                                count &lt;= <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">else</span> count &lt;= count + <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="小键盘映射模块"><a href="#小键盘映射模块" class="headerlink" title="小键盘映射模块"></a>小键盘映射模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> keyboard_map(</span><br><span class="line">    <span class="keyword">input</span>[<span class="number">15</span>:<span class="number">0</span>] key_in,</span><br><span class="line">    <span class="keyword">output</span>[<span class="number">15</span>:<span class="number">0</span>] key_out</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">13</span>] = ~key_in[<span class="number">15</span>]; <span class="comment">// D</span></span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">12</span>] = ~key_in[<span class="number">14</span>]; <span class="comment">// C</span></span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">11</span>] = ~key_in[<span class="number">13</span>]; <span class="comment">// B</span></span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">10</span>] = ~key_in[<span class="number">12</span>]; <span class="comment">// A</span></span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">15</span>] = ~key_in[<span class="number">11</span>];  <span class="comment">// #</span></span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">9</span>] = ~key_in[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">6</span>] = ~key_in[<span class="number">9</span>];</span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">3</span>] = ~key_in[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">0</span>] = ~key_in[<span class="number">7</span>];</span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">8</span>] = ~key_in[<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">5</span>] = ~key_in[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">2</span>] = ~key_in[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">14</span>] = ~key_in[<span class="number">3</span>]; <span class="comment">// *</span></span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">7</span>] = ~key_in[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">4</span>] = ~key_in[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">assign</span> key_out[<span class="number">1</span>] = ~key_in[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="电量充值模块"><a href="#电量充值模块" class="headerlink" title="电量充值模块"></a>电量充值模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> charge(</span><br><span class="line">    <span class="keyword">input</span> clkin,</span><br><span class="line">    <span class="keyword">input</span> rst,charge,<span class="comment">//16位numbers依次表示0-9，A,B,C,D,*,#;charge为1表示充值状态,rst复位,charge=1表示进入充电模式</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>]numbers, <span class="comment">// 小键盘输入信息</span></span><br><span class="line">    <span class="keyword">input</span> on_off, ifon_elec, <span class="comment">// 开关机</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>]electricity, <span class="comment">// 电量</span></span><br><span class="line">    <span class="keyword">output</span> input_end<span class="comment">//分别表示充电电量和输入是否结束</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> inend;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] temp;</span><br><span class="line">    <span class="keyword">reg</span> ifinput; <span class="comment">// 锁定输入</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> input_end = inend;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> clk;</span><br><span class="line">    div div_in(clkin, rst, clk);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">negedge</span> rst) <span class="keyword">begin</span><span class="comment">//若复位信号，充入电量归零</span></span><br><span class="line">        <span class="keyword">if</span> (~rst) <span class="keyword">begin</span></span><br><span class="line">            temp &lt;= <span class="number">4&#x27;d12</span>;</span><br><span class="line">            inend &lt;= <span class="number">0</span>;</span><br><span class="line">            electricity &lt;= <span class="number">0</span>;</span><br><span class="line">            ifinput &lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (electricity &lt; <span class="number">1000</span> &amp;&amp; charge == <span class="number">1</span> &amp;&amp; !(on_off &amp;&amp; ifon_elec)) <span class="keyword">begin</span><span class="comment">//在充入电量小于1000，同时输入未结束的情况下</span></span><br><span class="line">                <span class="keyword">if</span> (numbers == <span class="number">16&#x27;b0000_0000_0000_0001</span>) <span class="keyword">begin</span><span class="comment">//输入0</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0000_0010</span>) <span class="keyword">begin</span><span class="comment">//输入1</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0000_0100</span>) <span class="keyword">begin</span><span class="comment">//输入2</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d2</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0000_1000</span>) <span class="keyword">begin</span><span class="comment">//输入3</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d3</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0001_0000</span>) <span class="keyword">begin</span><span class="comment">//输入4</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d4</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0010_0000</span>) <span class="keyword">begin</span><span class="comment">//输入5</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d5</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0100_0000</span>) <span class="keyword">begin</span><span class="comment">//输入6</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d6</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_1000_0000</span>) <span class="keyword">begin</span><span class="comment">//输入7</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d7</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0001_0000_0000</span>) <span class="keyword">begin</span><span class="comment">//输入8</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d8</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0010_0000_0000</span>) <span class="keyword">begin</span><span class="comment">//输入9</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d9</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0100_0000_0000</span>) <span class="keyword">begin</span><span class="comment">//输入A,停止输入</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d10</span>;</span><br><span class="line">                    inend&lt;=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0001_0000_0000_0000</span>) <span class="keyword">begin</span><span class="comment">//输入C,清空充电电量</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d11</span>;</span><br><span class="line">                    electricity &lt;= <span class="number">0</span>;</span><br><span class="line">                    inend&lt;=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d12</span>;</span><br><span class="line">                    ifinput &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(ifinput == <span class="number">1</span> &amp;&amp; temp != <span class="number">4&#x27;d12</span> &amp;&amp; temp != <span class="number">4&#x27;d10</span> &amp;&amp; temp != <span class="number">4&#x27;d11</span> &amp;&amp; electricity * <span class="number">10</span> + temp &lt; <span class="number">1000</span>) <span class="keyword">begin</span></span><br><span class="line">                    ifinput &lt;= <span class="number">0</span>;</span><br><span class="line">                    electricity &lt;= electricity * <span class="number">10</span> + temp;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="倒计时关机输入模块"><a href="#倒计时关机输入模块" class="headerlink" title="倒计时关机输入模块"></a>倒计时关机输入模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> countdown_input(</span><br><span class="line">    <span class="keyword">input</span> clkin,</span><br><span class="line">    <span class="keyword">input</span> rst,charge,<span class="comment">//16位numbers依次表示0-9，A,B,C,D,*,#;charge为1表示设定倒计时状态,rst复位,charge=1表示进入设定倒计时模式</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>]numbers, <span class="comment">// 小键盘输入信息</span></span><br><span class="line">    <span class="keyword">input</span> on_off, ifon_elec, <span class="comment">// 开关机</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] select, <span class="comment">// 选择模式,00为倒计时显示</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>]electricity, <span class="comment">// 电量</span></span><br><span class="line">    <span class="keyword">output</span> input_end<span class="comment">//分别表示设定倒计时是否结束</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> inend;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] temp;</span><br><span class="line">    <span class="keyword">reg</span> ifinput; <span class="comment">// 锁定输入</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> input_end = inend;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> clk;</span><br><span class="line">    div div_in(clkin, rst, clk);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">negedge</span> rst) <span class="keyword">begin</span><span class="comment">//若复位信号，倒计时归零</span></span><br><span class="line">        <span class="keyword">if</span> (~rst) <span class="keyword">begin</span></span><br><span class="line">            temp &lt;= <span class="number">4&#x27;d12</span>;</span><br><span class="line">            inend &lt;= <span class="number">0</span>;</span><br><span class="line">            electricity &lt;= <span class="number">0</span>;</span><br><span class="line">            ifinput &lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (electricity &lt; <span class="number">1000</span> &amp;&amp; charge == <span class="number">1</span> &amp;&amp; on_off &amp;&amp; ifon_elec &amp;&amp; select == <span class="number">0</span>) <span class="keyword">begin</span><span class="comment">//在设定时间小于1000，同时输入未结束的情况下</span></span><br><span class="line">                <span class="keyword">if</span> (numbers == <span class="number">16&#x27;b0000_0000_0000_0001</span>) <span class="keyword">begin</span><span class="comment">//输入0</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0000_0010</span>) <span class="keyword">begin</span><span class="comment">//输入1</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0000_0100</span>) <span class="keyword">begin</span><span class="comment">//输入2</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d2</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0000_1000</span>) <span class="keyword">begin</span><span class="comment">//输入3</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d3</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0001_0000</span>) <span class="keyword">begin</span><span class="comment">//输入4</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d4</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0010_0000</span>) <span class="keyword">begin</span><span class="comment">//输入5</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d5</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_0100_0000</span>) <span class="keyword">begin</span><span class="comment">//输入6</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d6</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0000_1000_0000</span>) <span class="keyword">begin</span><span class="comment">//输入7</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d7</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0001_0000_0000</span>) <span class="keyword">begin</span><span class="comment">//输入8</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d8</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0010_0000_0000</span>) <span class="keyword">begin</span><span class="comment">//输入9</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d9</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0000_0100_0000_0000</span>) <span class="keyword">begin</span><span class="comment">//输入A,停止输入</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d10</span>;</span><br><span class="line">                    inend&lt;=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (numbers==<span class="number">16&#x27;b0001_0000_0000_0000</span>) <span class="keyword">begin</span><span class="comment">//输入C,清空充电电量</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d11</span>;</span><br><span class="line">                    electricity &lt;= <span class="number">0</span>;</span><br><span class="line">                    inend&lt;=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    temp &lt;= <span class="number">4&#x27;d12</span>;</span><br><span class="line">                    ifinput &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(ifinput == <span class="number">1</span> &amp;&amp; temp != <span class="number">4&#x27;d12</span> &amp;&amp; temp != <span class="number">4&#x27;d10</span> &amp;&amp; temp != <span class="number">4&#x27;d11</span>) <span class="keyword">begin</span></span><br><span class="line">                    ifinput &lt;= <span class="number">0</span>;</span><br><span class="line">                    electricity &lt;= electricity * <span class="number">10</span> + temp;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="倒计时关机顶层模块"><a href="#倒计时关机顶层模块" class="headerlink" title="倒计时关机顶层模块"></a>倒计时关机顶层模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> auto_off_top(</span><br><span class="line">    <span class="keyword">input</span> on_off,</span><br><span class="line">    <span class="keyword">input</span> clock_Y18, <span class="comment">// Y18</span></span><br><span class="line">    <span class="keyword">input</span> rst, <span class="comment">// 复位</span></span><br><span class="line">    <span class="keyword">input</span> confirm, <span class="comment">// 确定输入</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] ctime, <span class="comment">// 倒计时的时间</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> shutdown, <span class="comment">// 1开机</span></span><br><span class="line">    <span class="keyword">output</span> beep, <span class="comment">//输出的音乐</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] count_down <span class="comment">// 十bit输出</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> rst_b;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] num;</span><br><span class="line">    <span class="keyword">reg</span> temp;</span><br><span class="line"></span><br><span class="line">    beep beep_ring(clock_Y18, rst_b, beep);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clock_Y18 <span class="keyword">or</span> <span class="keyword">negedge</span> rst) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(~rst) <span class="keyword">begin</span></span><br><span class="line">            count_down &lt;= <span class="number">0</span>;</span><br><span class="line">            num &lt;= <span class="number">0</span>;</span><br><span class="line">            shutdown &lt;= <span class="number">1</span>;</span><br><span class="line">            rst_b &lt;= <span class="number">0</span>;</span><br><span class="line">            temp &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (confirm == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            count_down &lt;= ctime;</span><br><span class="line">            temp &lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (count_down != <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (num &lt; <span class="number">100000000</span>) <span class="keyword">begin</span></span><br><span class="line">                    num &lt;= num + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(num == <span class="number">100000000</span>) <span class="keyword">begin</span></span><br><span class="line">                    count_down &lt;= count_down - <span class="number">1</span>;</span><br><span class="line">                    num &lt;= <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (count_down == <span class="number">10</span>) <span class="keyword">begin</span></span><br><span class="line">                rst_b &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (count_down == <span class="number">0</span> &amp;&amp; temp) <span class="keyword">begin</span></span><br><span class="line">                shutdown &lt;= <span class="number">0</span>;</span><br><span class="line">                temp &lt;= <span class="number">0</span>;</span><br><span class="line">                rst_b &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!on_off) <span class="keyword">begin</span></span><br><span class="line">                count_down &lt;= <span class="number">0</span>;</span><br><span class="line">                num &lt;= <span class="number">0</span>;</span><br><span class="line">                shutdown &lt;= <span class="number">1</span>;</span><br><span class="line">                rst_b &lt;= <span class="number">0</span>;</span><br><span class="line">                temp &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="剩余10s蜂鸣器提示顶层模块"><a href="#剩余10s蜂鸣器提示顶层模块" class="headerlink" title="剩余10s蜂鸣器提示顶层模块"></a>剩余10s蜂鸣器提示顶层模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> auto_off_top(</span><br><span class="line">    <span class="keyword">input</span> on_off,</span><br><span class="line">    <span class="keyword">input</span> clock_Y18, <span class="comment">// Y18</span></span><br><span class="line">    <span class="keyword">input</span> rst, <span class="comment">// 复位</span></span><br><span class="line">    <span class="keyword">input</span> confirm,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] ctime, <span class="comment">// 倒计时的时间</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> shutdown, <span class="comment">// 1开机</span></span><br><span class="line">    <span class="keyword">output</span> beep, <span class="comment">//输出的音乐</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] count_down</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> rst_b;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] num;</span><br><span class="line">    <span class="keyword">reg</span> temp;</span><br><span class="line"></span><br><span class="line">    beep beep_ring(clock_Y18, rst_b, beep);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clock_Y18 <span class="keyword">or</span> <span class="keyword">negedge</span> rst) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(~rst) <span class="keyword">begin</span></span><br><span class="line">            count_down &lt;= <span class="number">0</span>;</span><br><span class="line">            num &lt;= <span class="number">0</span>;</span><br><span class="line">            shutdown &lt;= <span class="number">1</span>;</span><br><span class="line">            rst_b &lt;= <span class="number">0</span>;</span><br><span class="line">            temp &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (confirm == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            count_down &lt;= ctime;</span><br><span class="line">            temp &lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (count_down != <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (num &lt; <span class="number">100000000</span>) <span class="keyword">begin</span></span><br><span class="line">                    num &lt;= num + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(num == <span class="number">100000000</span>) <span class="keyword">begin</span></span><br><span class="line">                    count_down &lt;= count_down - <span class="number">1</span>;</span><br><span class="line">                    num &lt;= <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (count_down == <span class="number">10</span>) <span class="keyword">begin</span></span><br><span class="line">                rst_b &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (count_down == <span class="number">0</span> &amp;&amp; temp) <span class="keyword">begin</span></span><br><span class="line">                shutdown &lt;= <span class="number">0</span>;</span><br><span class="line">                temp &lt;= <span class="number">0</span>;</span><br><span class="line">                rst_b &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!on_off) <span class="keyword">begin</span></span><br><span class="line">                count_down &lt;= <span class="number">0</span>;</span><br><span class="line">                num &lt;= <span class="number">0</span>;</span><br><span class="line">                shutdown &lt;= <span class="number">1</span>;</span><br><span class="line">                rst_b &lt;= <span class="number">0</span>;</span><br><span class="line">                temp &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="蜂鸣器顶层模块"><a href="#蜂鸣器顶层模块" class="headerlink" title="蜂鸣器顶层模块"></a>蜂鸣器顶层模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> beep(clk, rst_n, beep);</span><br><span class="line">     <span class="keyword">input</span> clk, rst_n;           <span class="comment">//输入100Mhz时钟信号,复位信号</span></span><br><span class="line">     <span class="keyword">output</span> beep;            <span class="comment">//输出的方波</span></span><br><span class="line">     </span><br><span class="line">     <span class="keyword">wire</span> clk_1M, time_finsh;    <span class="comment">//1Mhz时钟信号线，0.25s时间计数标记位</span></span><br><span class="line">     <span class="keyword">wire</span> [<span class="number">6</span>:<span class="number">0</span>]addr;             <span class="comment">//rom地址线</span></span><br><span class="line">     <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>]rom_data;         <span class="comment">//rom数据线</span></span><br><span class="line">     <span class="keyword">wire</span> [<span class="number">10</span>:<span class="number">0</span>]music_data;      <span class="comment">//rom数据解码数据线</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">//1M_Hz时间分频模块</span></span><br><span class="line">     div_frequency <span class="variable">#(100)</span>my_time_1MHz_inst (             </span><br><span class="line">         <span class="variable">.rst</span>(rst_n),</span><br><span class="line">         <span class="variable">.clk</span>(clk),</span><br><span class="line">         <span class="variable">.clkout</span>(clk_1M)</span><br><span class="line">     );</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//0.25s时间计数器模块</span></span><br><span class="line">     div_frequency <span class="variable">#(625000)</span>time_counter_inst(</span><br><span class="line">         <span class="variable">.rst</span>(rst_n),</span><br><span class="line">         <span class="variable">.clk</span>(clk_1M),</span><br><span class="line">         <span class="variable">.clkout</span>(time_finsh)</span><br><span class="line">     );  </span><br><span class="line">         </span><br><span class="line">     <span class="comment">//ROM地址发生器</span></span><br><span class="line">     addr_gen addr_gen_inst(         </span><br><span class="line">         <span class="variable">.clk</span>(clk_1M),</span><br><span class="line">         <span class="variable">.rst_n</span>(rst_n),</span><br><span class="line">         <span class="variable">.addr</span>(addr),</span><br><span class="line">         <span class="variable">.time_finsh</span>(time_finsh)</span><br><span class="line">     );  </span><br><span class="line">     </span><br><span class="line">     <span class="comment">//ROM模块</span></span><br><span class="line">     my_rom my_rom_inst(             </span><br><span class="line">         <span class="variable">.address</span>(addr),</span><br><span class="line">         <span class="variable">.q</span>(rom_data)</span><br><span class="line">     );</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//解码模块</span></span><br><span class="line">     decode decode_inst(             </span><br><span class="line">         <span class="variable">.clk</span>(clk_1M),</span><br><span class="line">         <span class="variable">.rst_n</span>(rst_n),  </span><br><span class="line">         <span class="variable">.rom_data</span>(rom_data),</span><br><span class="line">         <span class="variable">.music_data</span>(music_data)</span><br><span class="line">     );                  </span><br><span class="line">     </span><br><span class="line">     <span class="comment">//音乐发生器模块</span></span><br><span class="line">     music_gen music_gen_inst(       </span><br><span class="line">         <span class="variable">.clk</span>(clk_1M),</span><br><span class="line">         <span class="variable">.rst_n</span>(rst_n),</span><br><span class="line">         <span class="variable">.music_data</span>(music_data),</span><br><span class="line">         <span class="variable">.beep</span>(beep)</span><br><span class="line">     );                  </span><br><span class="line">         </span><br><span class="line"> <span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="ROM选择模块"><a href="#ROM选择模块" class="headerlink" title="ROM选择模块"></a>ROM选择模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> addr_gen(clk, rst_n, addr, time_finsh);</span><br><span class="line">                         </span><br><span class="line">     <span class="keyword">input</span> clk, rst_n;   <span class="comment">//输入1Mhz时钟信号，复位信号</span></span><br><span class="line">     <span class="keyword">input</span> time_finsh;   <span class="comment">//输入时间计数标记位（每0.25s变高电平一次）</span></span><br><span class="line">     <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>]addr; <span class="comment">//输出给ROM的地址信号</span></span><br><span class="line">     </span><br><span class="line">     <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n)</span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">         <span class="keyword">if</span>(!rst_n)</span><br><span class="line">             addr    &lt;=  <span class="number">7&#x27;d0</span>;   <span class="comment">//输出给ROM的地址信号复位</span></span><br><span class="line">         <span class="keyword">else</span>    <span class="keyword">if</span>(time_finsh) <span class="comment">//输出给ROM的地址信号自加1（每0.25s自加1）</span></span><br><span class="line">             addr    &lt;=  addr    +   <span class="number">1&#x27;d1</span>;   </span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             addr    &lt;=  addr;       <span class="comment">//未够0.25s,ROM的地址信号不变</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">     </span><br><span class="line"> <span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="ROM数据记录模块"><a href="#ROM数据记录模块" class="headerlink" title="ROM数据记录模块"></a>ROM数据记录模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">module</span> my_rom(</span><br><span class="line"><span class="keyword">input</span> [<span class="number">6</span>:<span class="number">0</span>] address,</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">reg</span>  [<span class="number">7</span>:<span class="number">0</span>] q</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] my_memory [<span class="number">0</span>:<span class="number">127</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">initial</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">my_memory[<span class="number">0</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">1</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">2</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">3</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">4</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">5</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">6</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">7</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">8</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">9</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">10</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">11</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">12</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">13</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">14</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">15</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">16</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">17</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">18</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">19</span>] = <span class="number">8&#x27;h44</span>;</span><br><span class="line">my_memory[<span class="number">20</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">21</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">22</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">23</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">24</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">25</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">26</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">27</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">28</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">29</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">30</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">31</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">32</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">33</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">34</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">35</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">36</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">37</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">38</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">39</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">40</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">41</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">42</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">43</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">44</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">45</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">46</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">47</span>] = <span class="number">8&#x27;h45</span>;</span><br><span class="line">my_memory[<span class="number">48</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">49</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">50</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">51</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">52</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">53</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">54</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">55</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">56</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line"></span><br><span class="line">my_memory[<span class="number">56</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">57</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">58</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">59</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">60</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">61</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">62</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">63</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">64</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">65</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">66</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">67</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">68</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">69</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">70</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">71</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">72</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">73</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">74</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">75</span>] = <span class="number">8&#x27;h44</span>;</span><br><span class="line">my_memory[<span class="number">76</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">77</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">78</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">79</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">80</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">81</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">82</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">83</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">84</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">85</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">86</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">87</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">88</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">89</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">90</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">91</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">92</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">93</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">94</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">95</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">96</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">97</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">98</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">99</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">100</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">101</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">102</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">103</span>] = <span class="number">8&#x27;h45</span>;</span><br><span class="line">my_memory[<span class="number">104</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">105</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">106</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">107</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">108</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">109</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">110</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">111</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">112</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line"></span><br><span class="line">my_memory[<span class="number">113</span>] = <span class="number">8&#x27;h25</span>;</span><br><span class="line">my_memory[<span class="number">114</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">115</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">116</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">117</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">118</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line">my_memory[<span class="number">119</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">120</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">121</span>] = <span class="number">8&#x27;h26</span>;</span><br><span class="line">my_memory[<span class="number">122</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">123</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">124</span>] = <span class="number">8&#x27;h43</span>;</span><br><span class="line">my_memory[<span class="number">125</span>] = <span class="number">8&#x27;h42</span>;</span><br><span class="line">my_memory[<span class="number">126</span>] = <span class="number">8&#x27;h41</span>;</span><br><span class="line">my_memory[<span class="number">127</span>] = <span class="number">8&#x27;h27</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (address)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (address)</span><br><span class="line"><span class="number">7&#x27;d0</span>: q = my_memory[<span class="number">0</span>];</span><br><span class="line"><span class="number">7&#x27;d1</span>: q = my_memory[<span class="number">1</span>];</span><br><span class="line"><span class="number">7&#x27;d2</span>: q = my_memory[<span class="number">2</span>];</span><br><span class="line"><span class="number">7&#x27;d3</span>: q = my_memory[<span class="number">3</span>];</span><br><span class="line"><span class="number">7&#x27;d4</span>: q = my_memory[<span class="number">4</span>];</span><br><span class="line"><span class="number">7&#x27;d5</span>: q = my_memory[<span class="number">5</span>];</span><br><span class="line"><span class="number">7&#x27;d6</span>: q = my_memory[<span class="number">6</span>];</span><br><span class="line"><span class="number">7&#x27;d7</span>: q = my_memory[<span class="number">7</span>];</span><br><span class="line"><span class="number">7&#x27;d8</span>: q = my_memory[<span class="number">8</span>];</span><br><span class="line"><span class="number">7&#x27;d9</span>: q = my_memory[<span class="number">9</span>];</span><br><span class="line"><span class="number">7&#x27;d10</span>: q = my_memory[<span class="number">10</span>];</span><br><span class="line"><span class="number">7&#x27;d11</span>: q = my_memory[<span class="number">11</span>];</span><br><span class="line"><span class="number">7&#x27;d12</span>: q = my_memory[<span class="number">12</span>];</span><br><span class="line"><span class="number">7&#x27;d13</span>: q = my_memory[<span class="number">13</span>];</span><br><span class="line"><span class="number">7&#x27;d14</span>: q = my_memory[<span class="number">14</span>];</span><br><span class="line"><span class="number">7&#x27;d15</span>: q = my_memory[<span class="number">15</span>];</span><br><span class="line"><span class="number">7&#x27;d16</span>: q = my_memory[<span class="number">16</span>];</span><br><span class="line"><span class="number">7&#x27;d17</span>: q = my_memory[<span class="number">17</span>];</span><br><span class="line"><span class="number">7&#x27;d18</span>: q = my_memory[<span class="number">18</span>];</span><br><span class="line"><span class="number">7&#x27;d19</span>: q = my_memory[<span class="number">19</span>];</span><br><span class="line"><span class="number">7&#x27;d20</span>: q = my_memory[<span class="number">20</span>];</span><br><span class="line"><span class="number">7&#x27;d21</span>: q = my_memory[<span class="number">21</span>];</span><br><span class="line"><span class="number">7&#x27;d22</span>: q = my_memory[<span class="number">22</span>];</span><br><span class="line"><span class="number">7&#x27;d23</span>: q = my_memory[<span class="number">23</span>];</span><br><span class="line"><span class="number">7&#x27;d24</span>: q = my_memory[<span class="number">24</span>];</span><br><span class="line"><span class="number">7&#x27;d25</span>: q = my_memory[<span class="number">25</span>];</span><br><span class="line"><span class="number">7&#x27;d26</span>: q = my_memory[<span class="number">26</span>];</span><br><span class="line"><span class="number">7&#x27;d27</span>: q = my_memory[<span class="number">27</span>];</span><br><span class="line"><span class="number">7&#x27;d28</span>: q = my_memory[<span class="number">28</span>];</span><br><span class="line"><span class="number">7&#x27;d29</span>: q = my_memory[<span class="number">29</span>];</span><br><span class="line"><span class="number">7&#x27;d30</span>: q = my_memory[<span class="number">30</span>];</span><br><span class="line"><span class="number">7&#x27;d31</span>: q = my_memory[<span class="number">31</span>];</span><br><span class="line"><span class="number">7&#x27;d32</span>: q = my_memory[<span class="number">32</span>];</span><br><span class="line"><span class="number">7&#x27;d33</span>: q = my_memory[<span class="number">33</span>];</span><br><span class="line"><span class="number">7&#x27;d34</span>: q = my_memory[<span class="number">34</span>];</span><br><span class="line"><span class="number">7&#x27;d35</span>: q = my_memory[<span class="number">35</span>];</span><br><span class="line"><span class="number">7&#x27;d36</span>: q = my_memory[<span class="number">36</span>];</span><br><span class="line"><span class="number">7&#x27;d37</span>: q = my_memory[<span class="number">37</span>];</span><br><span class="line"><span class="number">7&#x27;d38</span>: q = my_memory[<span class="number">38</span>];</span><br><span class="line"><span class="number">7&#x27;d39</span>: q = my_memory[<span class="number">39</span>];</span><br><span class="line"><span class="number">7&#x27;d40</span>: q = my_memory[<span class="number">40</span>];</span><br><span class="line"><span class="number">7&#x27;d41</span>: q = my_memory[<span class="number">41</span>];</span><br><span class="line"><span class="number">7&#x27;d42</span>: q = my_memory[<span class="number">42</span>];</span><br><span class="line"><span class="number">7&#x27;d43</span>: q = my_memory[<span class="number">43</span>];</span><br><span class="line"><span class="number">7&#x27;d44</span>: q = my_memory[<span class="number">44</span>];</span><br><span class="line"><span class="number">7&#x27;d45</span>: q = my_memory[<span class="number">45</span>];</span><br><span class="line"><span class="number">7&#x27;d46</span>: q = my_memory[<span class="number">46</span>];</span><br><span class="line"><span class="number">7&#x27;d47</span>: q = my_memory[<span class="number">47</span>];</span><br><span class="line"><span class="number">7&#x27;d48</span>: q = my_memory[<span class="number">48</span>];</span><br><span class="line"><span class="number">7&#x27;d49</span>: q = my_memory[<span class="number">49</span>];</span><br><span class="line"><span class="number">7&#x27;d50</span>: q = my_memory[<span class="number">50</span>];</span><br><span class="line"><span class="number">7&#x27;d51</span>: q = my_memory[<span class="number">51</span>];</span><br><span class="line"><span class="number">7&#x27;d52</span>: q = my_memory[<span class="number">52</span>];</span><br><span class="line"><span class="number">7&#x27;d53</span>: q = my_memory[<span class="number">53</span>];</span><br><span class="line"><span class="number">7&#x27;d54</span>: q = my_memory[<span class="number">54</span>];</span><br><span class="line"><span class="number">7&#x27;d55</span>: q = my_memory[<span class="number">55</span>];</span><br><span class="line"><span class="number">7&#x27;d56</span>: q = my_memory[<span class="number">56</span>];</span><br><span class="line"><span class="number">7&#x27;d57</span>: q = my_memory[<span class="number">57</span>];</span><br><span class="line"><span class="number">7&#x27;d58</span>: q = my_memory[<span class="number">58</span>];</span><br><span class="line"><span class="number">7&#x27;d59</span>: q = my_memory[<span class="number">59</span>];</span><br><span class="line"><span class="number">7&#x27;d60</span>: q = my_memory[<span class="number">60</span>];</span><br><span class="line"><span class="number">7&#x27;d61</span>: q = my_memory[<span class="number">61</span>];</span><br><span class="line"><span class="number">7&#x27;d62</span>: q = my_memory[<span class="number">62</span>];</span><br><span class="line"><span class="number">7&#x27;d63</span>: q = my_memory[<span class="number">63</span>];</span><br><span class="line"><span class="number">7&#x27;d64</span>: q = my_memory[<span class="number">64</span>];</span><br><span class="line"><span class="number">7&#x27;d65</span>: q = my_memory[<span class="number">65</span>];</span><br><span class="line"><span class="number">7&#x27;d66</span>: q = my_memory[<span class="number">66</span>];</span><br><span class="line"><span class="number">7&#x27;d67</span>: q = my_memory[<span class="number">67</span>];</span><br><span class="line"><span class="number">7&#x27;d68</span>: q = my_memory[<span class="number">68</span>];</span><br><span class="line"><span class="number">7&#x27;d69</span>: q = my_memory[<span class="number">69</span>];</span><br><span class="line"><span class="number">7&#x27;d70</span>: q = my_memory[<span class="number">70</span>];</span><br><span class="line"><span class="number">7&#x27;d71</span>: q = my_memory[<span class="number">71</span>];</span><br><span class="line"><span class="number">7&#x27;d72</span>: q = my_memory[<span class="number">72</span>];</span><br><span class="line"><span class="number">7&#x27;d73</span>: q = my_memory[<span class="number">73</span>];</span><br><span class="line"><span class="number">7&#x27;d74</span>: q = my_memory[<span class="number">74</span>];</span><br><span class="line"><span class="number">7&#x27;d75</span>: q = my_memory[<span class="number">75</span>];</span><br><span class="line"><span class="number">7&#x27;d76</span>: q = my_memory[<span class="number">76</span>];</span><br><span class="line"><span class="number">7&#x27;d77</span>: q = my_memory[<span class="number">77</span>];</span><br><span class="line"><span class="number">7&#x27;d78</span>: q = my_memory[<span class="number">78</span>];</span><br><span class="line"><span class="number">7&#x27;d79</span>: q = my_memory[<span class="number">79</span>];</span><br><span class="line"><span class="number">7&#x27;d80</span>: q = my_memory[<span class="number">80</span>];</span><br><span class="line"><span class="number">7&#x27;d81</span>: q = my_memory[<span class="number">81</span>];</span><br><span class="line"><span class="number">7&#x27;d82</span>: q = my_memory[<span class="number">82</span>];</span><br><span class="line"><span class="number">7&#x27;d83</span>: q = my_memory[<span class="number">83</span>];</span><br><span class="line"><span class="number">7&#x27;d84</span>: q = my_memory[<span class="number">84</span>];</span><br><span class="line"><span class="number">7&#x27;d85</span>: q = my_memory[<span class="number">85</span>];</span><br><span class="line"><span class="number">7&#x27;d86</span>: q = my_memory[<span class="number">86</span>];</span><br><span class="line"><span class="number">7&#x27;d87</span>: q = my_memory[<span class="number">87</span>];</span><br><span class="line"><span class="number">7&#x27;d88</span>: q = my_memory[<span class="number">88</span>];</span><br><span class="line"><span class="number">7&#x27;d89</span>: q = my_memory[<span class="number">89</span>];</span><br><span class="line"><span class="number">7&#x27;d90</span>: q = my_memory[<span class="number">90</span>];</span><br><span class="line"><span class="number">7&#x27;d91</span>: q = my_memory[<span class="number">91</span>];</span><br><span class="line"><span class="number">7&#x27;d92</span>: q = my_memory[<span class="number">92</span>];</span><br><span class="line"><span class="number">7&#x27;d93</span>: q = my_memory[<span class="number">93</span>];</span><br><span class="line"><span class="number">7&#x27;d94</span>: q = my_memory[<span class="number">94</span>];</span><br><span class="line"><span class="number">7&#x27;d95</span>: q = my_memory[<span class="number">95</span>];</span><br><span class="line"><span class="number">7&#x27;d96</span>: q = my_memory[<span class="number">96</span>];</span><br><span class="line"><span class="number">7&#x27;d97</span>: q = my_memory[<span class="number">97</span>];</span><br><span class="line"><span class="number">7&#x27;d98</span>: q = my_memory[<span class="number">98</span>];</span><br><span class="line"><span class="number">7&#x27;d99</span>: q = my_memory[<span class="number">99</span>];</span><br><span class="line"><span class="number">7&#x27;d100</span>: q = my_memory[<span class="number">100</span>];</span><br><span class="line"><span class="number">7&#x27;d101</span>: q = my_memory[<span class="number">101</span>];</span><br><span class="line"><span class="number">7&#x27;d102</span>: q = my_memory[<span class="number">102</span>];</span><br><span class="line"><span class="number">7&#x27;d103</span>: q = my_memory[<span class="number">103</span>];</span><br><span class="line"><span class="number">7&#x27;d104</span>: q = my_memory[<span class="number">104</span>];</span><br><span class="line"><span class="number">7&#x27;d105</span>: q = my_memory[<span class="number">105</span>];</span><br><span class="line"><span class="number">7&#x27;d106</span>: q = my_memory[<span class="number">106</span>];</span><br><span class="line"><span class="number">7&#x27;d107</span>: q = my_memory[<span class="number">107</span>];</span><br><span class="line"><span class="number">7&#x27;d108</span>: q = my_memory[<span class="number">108</span>];</span><br><span class="line"><span class="number">7&#x27;d109</span>: q = my_memory[<span class="number">109</span>];</span><br><span class="line"><span class="number">7&#x27;d110</span>: q = my_memory[<span class="number">110</span>];</span><br><span class="line"><span class="number">7&#x27;d111</span>: q = my_memory[<span class="number">111</span>];</span><br><span class="line"><span class="number">7&#x27;d112</span>: q = my_memory[<span class="number">112</span>];</span><br><span class="line"><span class="number">7&#x27;d113</span>: q = my_memory[<span class="number">113</span>];</span><br><span class="line"><span class="number">7&#x27;d114</span>: q = my_memory[<span class="number">114</span>];</span><br><span class="line"><span class="number">7&#x27;d115</span>: q = my_memory[<span class="number">115</span>];</span><br><span class="line"><span class="number">7&#x27;d116</span>: q = my_memory[<span class="number">116</span>];</span><br><span class="line"><span class="number">7&#x27;d117</span>: q = my_memory[<span class="number">117</span>];</span><br><span class="line"><span class="number">7&#x27;d118</span>: q = my_memory[<span class="number">118</span>];</span><br><span class="line"><span class="number">7&#x27;d119</span>: q = my_memory[<span class="number">119</span>];</span><br><span class="line"><span class="number">7&#x27;d120</span>: q = my_memory[<span class="number">120</span>];</span><br><span class="line"><span class="number">7&#x27;d121</span>: q = my_memory[<span class="number">121</span>];</span><br><span class="line"><span class="number">7&#x27;d122</span>: q = my_memory[<span class="number">122</span>];</span><br><span class="line"><span class="number">7&#x27;d123</span>: q = my_memory[<span class="number">123</span>];</span><br><span class="line"><span class="number">7&#x27;d124</span>: q = my_memory[<span class="number">124</span>];</span><br><span class="line"><span class="number">7&#x27;d125</span>: q = my_memory[<span class="number">125</span>];</span><br><span class="line"><span class="number">7&#x27;d126</span>: q = my_memory[<span class="number">126</span>];</span><br><span class="line"><span class="number">7&#x27;d127</span>: q = my_memory[<span class="number">127</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="音乐解码模块"><a href="#音乐解码模块" class="headerlink" title="音乐解码模块"></a>音乐解码模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> decode(clk, rst_n, rom_data, music_data);</span><br><span class="line">                     </span><br><span class="line">     <span class="keyword">input</span> clk, rst_n;       <span class="comment">//输入1Mhz时钟信号，复位信号</span></span><br><span class="line">     <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] rom_data;    <span class="comment">//输入的ROM的数据</span></span><br><span class="line">     <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">10</span>:<span class="number">0</span>]music_data;    <span class="comment">//输出ROM的解码数据</span></span><br><span class="line">     </span><br><span class="line">     <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n)</span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">         <span class="keyword">if</span>(!rst_n)</span><br><span class="line">             music_data  &lt;=  <span class="number">11&#x27;d0</span>;      <span class="comment">//输出ROM的解码数据复位</span></span><br><span class="line">         <span class="keyword">else</span>    </span><br><span class="line">         <span class="keyword">case</span> (rom_data)</span><br><span class="line">             <span class="number">8&#x27;h11</span>   :   music_data  &lt;=  <span class="number">11&#x27;d1911</span>;   <span class="comment">//(1Mhz/261.63Hz)/2)=1191   低音1</span></span><br><span class="line">             <span class="number">8&#x27;h12</span>   :   music_data  &lt;=  <span class="number">11&#x27;d1702</span>;   <span class="comment">//(1Mhz/293.67Hz)/2)=1702   低音2</span></span><br><span class="line">             <span class="number">8&#x27;h13</span>   :   music_data  &lt;=  <span class="number">11&#x27;d1517</span>;   <span class="comment">//(1Mhz/329.63Hz)/2)=1517   低音3</span></span><br><span class="line">             <span class="number">8&#x27;h14</span>   :   music_data  &lt;=  <span class="number">11&#x27;d1431</span>;   <span class="comment">//(1Mhz/349.23Hz)/2)=1431   低音4</span></span><br><span class="line">             <span class="number">8&#x27;h15</span>   :   music_data  &lt;=  <span class="number">11&#x27;d1276</span>;   <span class="comment">//(1Mhz/391.99Hz)/2)=1276   低音5</span></span><br><span class="line">             <span class="number">8&#x27;h16</span>   :   music_data  &lt;=  <span class="number">11&#x27;d1136</span>;   <span class="comment">//(1Mhz/440.00Hz)/2)=1136   低音6</span></span><br><span class="line">             <span class="number">8&#x27;h17</span>   :   music_data  &lt;=  <span class="number">11&#x27;d1012</span>;   <span class="comment">//(1Mhz/493.88Hz)/2)=1012   低音7</span></span><br><span class="line">             </span><br><span class="line">             <span class="number">8&#x27;h21</span>   :   music_data  &lt;=  <span class="number">11&#x27;d939</span>;    <span class="comment">//(1Mhz/532.25Hz)/2)=939    中音1</span></span><br><span class="line">             <span class="number">8&#x27;h22</span>   :   music_data  &lt;=  <span class="number">11&#x27;d851</span>;    <span class="comment">//(1Mhz/587.33Hz)/2)=851    中音2</span></span><br><span class="line">             <span class="number">8&#x27;h23</span>   :   music_data  &lt;=  <span class="number">11&#x27;d758</span>;    <span class="comment">//(1Mhz/659.25Hz)/2)=758    中音3</span></span><br><span class="line">             <span class="number">8&#x27;h24</span>   :   music_data  &lt;=  <span class="number">11&#x27;d716</span>;    <span class="comment">//(1Mhz/698.46Hz)/2)=716    中音4</span></span><br><span class="line">             <span class="number">8&#x27;h25</span>   :   music_data  &lt;=  <span class="number">11&#x27;d638</span>;    <span class="comment">//(1Mhz/783.99Hz)/2)=638    中音5</span></span><br><span class="line">             <span class="number">8&#x27;h26</span>   :   music_data  &lt;=  <span class="number">11&#x27;d568</span>;    <span class="comment">//(1Mhz/880.00Hz)/2)=568    中音6</span></span><br><span class="line">             <span class="number">8&#x27;h27</span>   :   music_data  &lt;=  <span class="number">11&#x27;d506</span>;    <span class="comment">//(1Mhz/987.76Hz)/2)=506    中音7</span></span><br><span class="line">             </span><br><span class="line">             <span class="number">8&#x27;h41</span>   :   music_data  &lt;=  <span class="number">11&#x27;d478</span>;    <span class="comment">//(1Mhz/1046.50Hz)/2)=478   高音1</span></span><br><span class="line">             <span class="number">8&#x27;h42</span>   :   music_data  &lt;=  <span class="number">11&#x27;d425</span>;    <span class="comment">//(1Mhz/1174.66Hz)/2)=425   高音2</span></span><br><span class="line">             <span class="number">8&#x27;h43</span>   :   music_data  &lt;=  <span class="number">11&#x27;d379</span>;    <span class="comment">//(1Mhz/1318.51Hz)/2)=379   高音3</span></span><br><span class="line">             <span class="number">8&#x27;h44</span>   :   music_data  &lt;=  <span class="number">11&#x27;d358</span>;    <span class="comment">//(1Mhz/1396.51Hz)/2)=358   高音4</span></span><br><span class="line">             <span class="number">8&#x27;h45</span>   :   music_data  &lt;=  <span class="number">11&#x27;d319</span>;    <span class="comment">//(1Mhz/1567.98Hz)/2)=319   高音5</span></span><br><span class="line">             <span class="number">8&#x27;h46</span>   :   music_data  &lt;=  <span class="number">11&#x27;d284</span>;    <span class="comment">//(1Mhz/1760.00Hz)/2)=284   高音6</span></span><br><span class="line">             <span class="number">8&#x27;h47</span>   :   music_data  &lt;=  <span class="number">11&#x27;d253</span>;    <span class="comment">//(1Mhz/1975.52Hz)/2)=253   高音7</span></span><br><span class="line">             </span><br><span class="line">             <span class="number">8&#x27;h00</span>   :   music_data  &lt;=  <span class="number">11&#x27;d0</span>;      <span class="comment">//0HZ，停止节拍</span></span><br><span class="line">         <span class="keyword">endcase</span></span><br><span class="line">     <span class="keyword">end</span>     </span><br><span class="line">     </span><br><span class="line"> <span class="keyword">endmodule</span>               </span><br></pre></td></tr></table></figure>
<h4 id="音乐生成模块"><a href="#音乐生成模块" class="headerlink" title="音乐生成模块"></a>音乐生成模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> music_gen    (clk, rst_n, music_data, beep);</span><br><span class="line">                             </span><br><span class="line">     <span class="keyword">input</span> clk, rst_n;           <span class="comment">//输入1Mhz时钟信号，复位信号</span></span><br><span class="line">     <span class="keyword">input</span> [<span class="number">10</span>:<span class="number">0</span>]music_data; <span class="comment">//输入音乐频率控制字</span></span><br><span class="line">     <span class="keyword">output</span> <span class="keyword">reg</span> beep;            <span class="comment">//输出方波</span></span><br><span class="line">     </span><br><span class="line">     <span class="keyword">reg</span> [<span class="number">10</span>:<span class="number">0</span>]data, count;  <span class="comment">//寄存音乐控制字的data，计数器count</span></span><br><span class="line">     </span><br><span class="line">     <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n)</span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">         <span class="keyword">if</span>(!rst_n)</span><br><span class="line">             data    &lt;=  <span class="number">11&#x27;d0</span>;          <span class="comment">//寄存器data复位</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             data    &lt;=  music_data;     <span class="comment">//data寄存音乐控制字</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">         </span><br><span class="line">     <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n)</span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">         <span class="keyword">if</span>(!rst_n)</span><br><span class="line">             <span class="keyword">begin</span></span><br><span class="line">                 count   &lt;=  <span class="number">11&#x27;d1</span>;      <span class="comment">//计数器复位</span></span><br><span class="line">                 beep    &lt;=  <span class="number">1&#x27;d0</span>;       <span class="comment">//输出方波复位</span></span><br><span class="line">             <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span>    <span class="keyword">if</span>(data== <span class="number">11&#x27;d0</span>)   <span class="comment">//当data==11‘d0，（停止节拍）</span></span><br><span class="line">             <span class="keyword">begin</span></span><br><span class="line">                 count   &lt;=  <span class="number">11&#x27;d1</span>;   <span class="comment">//计数器归一</span></span><br><span class="line">                 beep    &lt;=  <span class="number">1&#x27;d0</span>;     <span class="comment">//输出方波归零</span></span><br><span class="line">             <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span>    <span class="keyword">if</span>(count    &lt;=  data)   <span class="comment">//当计数器小于等于data的值</span></span><br><span class="line">             count   &lt;=  count   +   <span class="number">1&#x27;d1</span>;<span class="comment">//计数器继续累加</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             <span class="keyword">begin</span></span><br><span class="line">                 count   &lt;=  <span class="number">11&#x27;d1</span>;  <span class="comment">//当计数器大于data的值，计数器归一</span></span><br><span class="line">                 beep    &lt;=  ~beep;  <span class="comment">//输出方波取反</span></span><br><span class="line">             <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="充值记录及查询模块"><a href="#充值记录及查询模块" class="headerlink" title="充值记录及查询模块"></a>充值记录及查询模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> memory(</span><br><span class="line">    <span class="keyword">input</span> lookup,rst,ifcharge,[<span class="number">9</span>:<span class="number">0</span>]electricity,</span><br><span class="line">    <span class="keyword">input</span> clkin,<span class="comment">//lookup为1表示进入查询模式</span></span><br><span class="line">    <span class="keyword">input</span> inend,left,right,mid,<span class="comment">//按动左右按键翻页</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">9</span>:<span class="number">0</span>] chargeInfo</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] cnt=<span class="number">0</span>;<span class="comment">//cnt记录当前有多少条充电信息</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] cur=<span class="number">0</span>;<span class="comment">//cur记录目前查询到第几条充电记录</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] chargeE;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] chargeElec[<span class="number">0</span>:<span class="number">9</span>];<span class="comment">//存储器记录充电信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> chargeInfo=chargeE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clkin, <span class="keyword">negedge</span> rst) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(~rst) <span class="keyword">begin</span><span class="comment">//复位信号，各项清零</span></span><br><span class="line">            cnt&lt;=<span class="number">4&#x27;d8</span>;</span><br><span class="line">            cur&lt;=<span class="number">4&#x27;d5</span>;</span><br><span class="line">            chargeE&lt;=<span class="number">0</span>;</span><br><span class="line">            chargeElec[<span class="number">0</span>]&lt;=<span class="number">10&#x27;d1</span>;</span><br><span class="line">            chargeElec[<span class="number">1</span>]&lt;=<span class="number">10&#x27;d2</span>;</span><br><span class="line">            chargeElec[<span class="number">2</span>]&lt;=<span class="number">10&#x27;d3</span>;</span><br><span class="line">            chargeElec[<span class="number">3</span>]&lt;=<span class="number">10&#x27;d4</span>;</span><br><span class="line">            chargeElec[<span class="number">4</span>]&lt;=<span class="number">10&#x27;d5</span>;</span><br><span class="line">            chargeElec[<span class="number">5</span>]&lt;=<span class="number">10&#x27;d6</span>;</span><br><span class="line">            chargeElec[<span class="number">6</span>]&lt;=<span class="number">10&#x27;d7</span>;</span><br><span class="line">            chargeElec[<span class="number">7</span>]&lt;=<span class="number">10&#x27;d8</span>;</span><br><span class="line">            chargeElec[<span class="number">8</span>]&lt;=<span class="number">10&#x27;d9</span>;</span><br><span class="line">            chargeElec[<span class="number">9</span>]&lt;=<span class="number">10&#x27;d2</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ifcharge&amp;&amp;inend&amp;&amp;mid) <span class="keyword">begin</span><span class="comment">//充电模式且输入结束且按下记录键的情况下，记录电量</span></span><br><span class="line">            <span class="comment">//chargeElec[cnt]&lt;=electricity;</span></span><br><span class="line">            <span class="keyword">if</span> (cnt==<span class="number">9</span>) <span class="keyword">begin</span></span><br><span class="line">                cnt&lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                cnt&lt;=cnt+<span class="number">1</span>; </span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">case</span> (cnt)</span><br><span class="line">                <span class="number">0</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeElec[<span class="number">0</span>]&lt;=electricity;</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">1</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeElec[<span class="number">1</span>]&lt;=electricity;</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">2</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeElec[<span class="number">2</span>]&lt;=electricity;</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">3</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeElec[<span class="number">3</span>]&lt;=electricity;</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">4</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeElec[<span class="number">4</span>]&lt;=electricity;</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">5</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeElec[<span class="number">5</span>]&lt;=electricity;</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">6</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeElec[<span class="number">6</span>]&lt;=electricity;</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">7</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeElec[<span class="number">7</span>]&lt;=electricity;</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">8</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeElec[<span class="number">8</span>]&lt;=electricity;</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">9</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeElec[<span class="number">9</span>]&lt;=electricity;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lookup) <span class="keyword">begin</span><span class="comment">//查询模式</span></span><br><span class="line">            <span class="keyword">if</span> (left) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (cur&gt;<span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                    cur&lt;=cur-<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    cur&lt;=cnt;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">case</span> (cur) </span><br><span class="line">                <span class="number">0</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">1</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">2</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">2</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">3</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">3</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">4</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">4</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">5</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">5</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">6</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">6</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">7</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">7</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">8</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">8</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">9</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">9</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (right) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (cur&lt;cnt) <span class="keyword">begin</span></span><br><span class="line">                    cur&lt;=cur+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    cur&lt;=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">case</span> (cur) </span><br><span class="line">                <span class="number">0</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">1</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">2</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">2</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">3</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">3</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">4</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">4</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">5</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">5</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">6</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">6</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">7</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">7</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">8</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">8</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">                <span class="number">9</span>: <span class="keyword">begin</span></span><br><span class="line">                    chargeE&lt;=chargeElec[<span class="number">9</span>];</span><br><span class="line">                <span class="keyword">end</span> </span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="致爱丽丝-外挂音乐模块"><a href="#致爱丽丝-外挂音乐模块" class="headerlink" title="致爱丽丝 外挂音乐模块"></a>致爱丽丝 外挂音乐模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> music(</span><br><span class="line">    <span class="keyword">input</span> clk,on,</span><br><span class="line">    <span class="keyword">output</span> signal</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设定不同的停顿与持续时间</span></span><br><span class="line">    <span class="keyword">parameter</span> ms300=<span class="number">15000000</span>;</span><br><span class="line">    <span class="keyword">parameter</span> ms400=<span class="number">5000000</span>;</span><br><span class="line">    <span class="keyword">parameter</span> ms900=<span class="number">45000000</span>;</span><br><span class="line">    <span class="keyword">parameter</span> ms600=<span class="number">15000000</span>;</span><br><span class="line">    <span class="keyword">parameter</span> ms350=<span class="number">4375000</span>;</span><br><span class="line">    <span class="keyword">parameter</span> ms1000=<span class="number">12500000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] state=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">reg</span> hz;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> c3,d3,e3,f3,g3,a3,b3,e4,dh4,c4,d4,gh3,ah3;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//生成对应音高的频率信号</span></span><br><span class="line">    pitch Cdo(clk,on,<span class="number">32&#x27;d262</span>,c3);</span><br><span class="line">    pitch Cre(clk,on,<span class="number">32&#x27;d294</span>,d3);</span><br><span class="line">    pitch Cmi(clk,on,<span class="number">32&#x27;d330</span>,e3);</span><br><span class="line">    pitch Cfa(clk,on,<span class="number">32&#x27;d349</span>,f3);</span><br><span class="line">    pitch Cso(clk,on,<span class="number">32&#x27;d392</span>,g3);</span><br><span class="line">    pitch Cla(clk,on,<span class="number">32&#x27;d440</span>,a3);</span><br><span class="line">    pitch Cti(clk,on,<span class="number">32&#x27;d494</span>,b3);</span><br><span class="line">    pitch Hmi(clk,on,<span class="number">32&#x27;d660</span>,e4);</span><br><span class="line">    pitch Sre(clk,on,<span class="number">32&#x27;d622</span>,dh4);</span><br><span class="line">    pitch Hdo(clk,on,<span class="number">32&#x27;d523</span>,c4);</span><br><span class="line">    pitch Hre(clk,on,<span class="number">32&#x27;d587</span>,d4);</span><br><span class="line">    pitch Sso(clk,on,<span class="number">32&#x27;d415</span>,gh3);</span><br><span class="line">    pitch Ah3(clk,on,<span class="number">32&#x27;d466</span>,ah3);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> signal=hz;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//根据每个音节的持续时间和停顿时间进行状态机的编码</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            <span class="number">0</span>: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>(cnt&lt;=ms600) <span class="keyword">begin</span></span><br><span class="line">                    hz&lt;=<span class="number">0</span>;</span><br><span class="line">                    cnt&lt;=cnt+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    state&lt;=state+<span class="number">1</span>;</span><br><span class="line">                    cnt&lt;=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">1</span>: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>(cnt&lt;=ms300) <span class="keyword">begin</span></span><br><span class="line">                    hz&lt;=e4;</span><br><span class="line">                    cnt&lt;=cnt+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    state&lt;=state+<span class="number">1</span>;</span><br><span class="line">                    cnt&lt;=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">2</span>: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>(cnt&lt;=ms350) <span class="keyword">begin</span></span><br><span class="line">                    hz&lt;=<span class="number">0</span>;</span><br><span class="line">                    cnt&lt;=cnt+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    state&lt;=state+<span class="number">1</span>;</span><br><span class="line">                    cnt&lt;=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="comment">//中间部分省略</span></span><br><span class="line">            <span class="number">67</span>: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>(cnt&lt;=ms400) <span class="keyword">begin</span></span><br><span class="line">                    hz&lt;=<span class="number">0</span>;</span><br><span class="line">                    cnt&lt;=cnt+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    state&lt;=state+<span class="number">1</span>;</span><br><span class="line">                    cnt&lt;=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">68</span>: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>(cnt&lt;=ms900) <span class="keyword">begin</span></span><br><span class="line">                    hz&lt;=a3;</span><br><span class="line">                    cnt&lt;=cnt+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    state&lt;=state+<span class="number">1</span>;</span><br><span class="line">                    cnt&lt;=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">69</span>: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>(cnt&lt;=ms1000) <span class="keyword">begin</span></span><br><span class="line">                    hz&lt;=<span class="number">0</span>;</span><br><span class="line">                    cnt&lt;=cnt+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    state&lt;=<span class="number">1</span>;</span><br><span class="line">                    cnt&lt;=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="外挂音乐模块-频率生成模块"><a href="#外挂音乐模块-频率生成模块" class="headerlink" title="外挂音乐模块 频率生成模块"></a>外挂音乐模块 频率生成模块</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据输入的频率，生成对应的频率信号</span></span><br><span class="line"><span class="keyword">module</span> pitch(</span><br><span class="line">    <span class="keyword">input</span> clk,on,[<span class="number">31</span>:<span class="number">0</span>] higher,</span><br><span class="line">    <span class="keyword">output</span> hz</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">19</span>:<span class="number">0</span>]count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">reg</span> bee=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> hz=bee;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(on) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (count&lt;=<span class="number">32&#x27;d100000000</span>/higher) <span class="keyword">begin</span></span><br><span class="line">                count&lt;=count+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                count&lt;=<span class="number">0</span>;</span><br><span class="line">                bee&lt;=~bee;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="（五）约束文件"><a href="#（五）约束文件" class="headerlink" title="（五）约束文件"></a>（五）约束文件</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">set_property PACKAGE_PIN W4 [get_ports &#123;on_off&#125;]		<span class="comment">//开机按钮</span></span><br><span class="line">set_property PACKAGE_PIN R4 [get_ports &#123;rst&#125;]			<span class="comment">//复位信号</span></span><br><span class="line">set_property PACKAGE_PIN Y18 [get_ports &#123;clk&#125;]			<span class="comment">//时钟信号</span></span><br><span class="line">set_property PACKAGE_PIN P5 [get_ports &#123;up_level&#125;]		<span class="comment">//上按键</span></span><br><span class="line">set_property PACKAGE_PIN P2 [get_ports &#123;down_level&#125;]	<span class="comment">//下按键</span></span><br><span class="line">set_property PACKAGE_PIN P1 [get_ports &#123;left_level&#125;]	<span class="comment">//左按键</span></span><br><span class="line">set_property PACKAGE_PIN R1 [get_ports &#123;right_level&#125;]	<span class="comment">//右按键</span></span><br><span class="line">set_property PACKAGE_PIN T4 [get_ports &#123;ifcharge&#125;]		<span class="comment">//是否进入充电模式</span></span><br><span class="line"></span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;on_off&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;rst&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;clk&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;up_level&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;down_level&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;left_level&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;right_level&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ifcharge&#125;]</span><br><span class="line"></span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;col[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;col[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;col[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;col[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;row[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;row[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;row[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;row[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN K6 [get_ports &#123;col[<span class="number">2</span>]&#125;]			<span class="comment">//小键盘端口绑定</span></span><br><span class="line">set_property PACKAGE_PIN M2 [get_ports &#123;col[<span class="number">3</span>]&#125;]			<span class="comment">//小键盘端口绑定</span></span><br><span class="line">set_property PACKAGE_PIN J4 [get_ports &#123;row[<span class="number">2</span>]&#125;]			<span class="comment">//小键盘端口绑定</span></span><br><span class="line">set_property PACKAGE_PIN K4 [get_ports &#123;row[<span class="number">3</span>]&#125;]			<span class="comment">//小键盘端口绑定</span></span><br><span class="line">set_property PACKAGE_PIN L5 [get_ports &#123;col[<span class="number">0</span>]&#125;]			<span class="comment">//小键盘端口绑定</span></span><br><span class="line">set_property PACKAGE_PIN J6 [get_ports &#123;col[<span class="number">1</span>]&#125;]			<span class="comment">//小键盘端口绑定</span></span><br><span class="line">set_property PACKAGE_PIN K3 [get_ports &#123;row[<span class="number">0</span>]&#125;]			<span class="comment">//小键盘端口绑定</span></span><br><span class="line">set_property PACKAGE_PIN L3 [get_ports &#123;row[<span class="number">1</span>]&#125;]			<span class="comment">//小键盘端口绑定</span></span><br><span class="line"></span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;Y[<span class="number">7</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;Y[<span class="number">6</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;Y[<span class="number">5</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;Y[<span class="number">4</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;Y[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;Y[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;Y[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;Y[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;DIG[<span class="number">7</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;DIG[<span class="number">6</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;DIG[<span class="number">5</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;DIG[<span class="number">4</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;DIG[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;DIG[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;DIG[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;DIG[<span class="number">0</span>]&#125;]</span><br><span class="line"></span><br><span class="line">set_property PACKAGE_PIN C19 [get_ports &#123;DIG[<span class="number">0</span>]&#125;]		<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN E19 [get_ports &#123;DIG[<span class="number">1</span>]&#125;]		<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN D19 [get_ports &#123;DIG[<span class="number">2</span>]&#125;]		<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN F18 [get_ports &#123;DIG[<span class="number">3</span>]&#125;]		<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN E18 [get_ports &#123;DIG[<span class="number">4</span>]&#125;]		<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN B20 [get_ports &#123;DIG[<span class="number">5</span>]&#125;]		<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN A20 [get_ports &#123;DIG[<span class="number">6</span>]&#125;]		<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN A18 [get_ports &#123;DIG[<span class="number">7</span>]&#125;]		<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN F15 [get_ports &#123;Y[<span class="number">0</span>]&#125;]			<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN F13 [get_ports &#123;Y[<span class="number">1</span>]&#125;]			<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN F14 [get_ports &#123;Y[<span class="number">2</span>]&#125;]			<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN F16 [get_ports &#123;Y[<span class="number">3</span>]&#125;]			<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN E17 [get_ports &#123;Y[<span class="number">4</span>]&#125;]			<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN C14 [get_ports &#123;Y[<span class="number">5</span>]&#125;]			<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN C15 [get_ports &#123;Y[<span class="number">6</span>]&#125;]			<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line">set_property PACKAGE_PIN E13 [get_ports &#123;Y[<span class="number">7</span>]&#125;]			<span class="comment">//七段数码显示管的绑定</span></span><br><span class="line"></span><br><span class="line">set_property PACKAGE_PIN A21 [get_ports &#123;charge_end&#125;]		<span class="comment">//充值状态显示LED</span></span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;charge_end&#125;]</span><br><span class="line"></span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports beep]</span><br><span class="line">set_property PACKAGE_PIN A19 [get_ports beep]				<span class="comment">//绑定蜂鸣器</span></span><br><span class="line"></span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports lookup]			<span class="comment">//充值记录查询按钮</span></span><br><span class="line">set_property PACKAGE_PIN T5 [get_ports lookup]</span><br><span class="line"></span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports middle_level]<span class="comment">//中间按键 是否记录本次充值</span></span><br><span class="line">set_property PACKAGE_PIN P4 [get_ports middle_level]</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h3><h4 id="（一）Testbench文件"><a href="#（一）Testbench文件" class="headerlink" title="（一）Testbench文件"></a>（一）Testbench文件</h4><h5 id="1-核心子模块仿真及测试"><a href="#1-核心子模块仿真及测试" class="headerlink" title="1. 核心子模块仿真及测试"></a>1. 核心子模块仿真及测试</h5><ul>
<li><p>小键盘模块的调试（采用上板测试的方式）：将小键盘模块的输出绑定至16个LED灯，测试当小键盘的某个按键被按下时，能否输出对应的电平信号，使对应的LED灯亮起。</p>
</li>
<li><p>电量充值记录查询功能的调试（采用上板测试的方式）：将冲入电量的二进制表示绑定至左侧10个LED灯，将查询模块显示电量的二进制表示绑定至右侧10个LED灯，最右侧的LED灯指示电量充值状态。通过两个拨码开关分别可以进入电量充值状态与记录查询状态。在记录查询状态可通过按动左右两个按钮来切换右侧LED灯显示的电量。</p>
</li>
</ul>
<h5 id="2-上板测试结果及说明"><a href="#2-上板测试结果及说明" class="headerlink" title="2. 上板测试结果及说明"></a>2. 上板测试结果及说明</h5><ul>
<li><h4 id="（二）上板测试结果拍照及说明"><a href="#（二）上板测试结果拍照及说明" class="headerlink" title="（二）上板测试结果拍照及说明"></a>（二）上板测试结果拍照及说明</h4></li>
</ul>
<hr>
<h3 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h3><h4 id="（一）开发过程中遇到的问题及解决方案"><a href="#（一）开发过程中遇到的问题及解决方案" class="headerlink" title="（一）开发过程中遇到的问题及解决方案"></a>（一）开发过程中遇到的问题及解决方案</h4><h5 id="问题1："><a href="#问题1：" class="headerlink" title="问题1："></a>问题1：</h5><p>在充电模块测试时出现按下任意按键后，小键盘模块会产生对应该按键的多个电平信号，在高频率时钟信号的驱动下， 充电模块会一次执行多次充电操作， 即按键一次， 充电很多次。</p>
<h5 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h5><p>通过对小键盘的按键信号输出进行防抖处理，使一次按键输出一个稳定的电平信号。同时更改充电模块，添加一个辅助判定变量(flag)， 将小键盘按键信号的输出响应锁定在一个时钟周期内。即在第一次扫描到小键盘输入时，flag为1，充电模块响应第一个时钟信号上升沿，进行充电，随后将附加判定条件flag设为0，在第二个时钟信号上升沿到来时，由于此时flag为0，即当前信号已经在第一次时钟信号中响应完毕，则不再响应，避免对同一次输入进行多次充电，在当输入结束确认充电时，再将flag置为1，等待下次充电响应。</p>
<h5 id="问题2："><a href="#问题2：" class="headerlink" title="问题2："></a>问题2：</h5><p>FPGA芯片板上按键抖动严重，按键一次，由于抖动会在激发状态和无效状态之间往复多次，会造成翻页信息显示混乱。</p>
<h4 id="解决方案：-1"><a href="#解决方案：-1" class="headerlink" title="解决方案："></a>解决方案：</h4><p>通过对板上按键进行防抖(key_vibration)，使得按键一次得到一个稳定的电平信号，在核心模块处理时敏感于经过防抖后稳定的时钟信号就可以取得较好的效果。</p>
<h4 id="（二）当前系统特色及优化方向"><a href="#（二）当前系统特色及优化方向" class="headerlink" title="（二）当前系统特色及优化方向"></a>（二）当前系统特色及优化方向</h4><p>1.系统特色<br>    1.七段数码显示管的显示内容可通过左右按键切换，能够直观地显示当前地状态信息。<br>    2.在开机状态显示模式与显示环境温度和设定温度的模块，可以通过上下按键改变当前模式或设定温度，与真实空调遥控器的设计一致，符合使用者的操作习惯。</p>
<p>2.优化方向<br>    1.音乐播放采用的是硬编码的方式，虽然能够较好地保留音乐本身的特点，但存在代码冗余程度高，编码新的音乐工作量大的问题。优化方向为编写一个完整的音乐播放模块，从曲谱的输入、每个音节的播放时间与停顿时间等各个方面实现更为简单的音乐编码模式。<br>    2.电量充值记录查询模块虽然已经开发完成，但在整合至系统中的过程中出现了一些列问题，导致最终并未在系统中实现该功能。 </p>

  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2021-01-05 18:36:50" itemprop="dateModified" datetime="2021-01-05T18:36:50+08:00">2021-01-05</time>
  </span>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>John Doe <i class="ic i-at"><em>@</em></i>Hexo
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://example.com/2021/01/05/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91project%20(2)/" title="Degital Design Project">http://example.com/2021/01/05/数字逻辑project (2)/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2021/01/05/hello-world/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipevuctzzj20zk0m84qp.jpg" title="Hello World">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Hello World</h3>
  </a>

    </div>
    <div class="item right">
    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91Project%E6%8A%A5%E5%91%8A"><span class="toc-number">1.</span> <span class="toc-text">数字逻辑Project报告</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%94%E2%80%94%E6%99%BA%E8%83%BD%E7%A9%BA%E8%B0%83%EF%BC%88%E4%BD%A0%E8%AF%B4%E5%BE%97%E9%83%BD%E9%98%9F%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">       ——智能空调（你说得都队）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%BC%80%E5%8F%91%E8%AE%A1%E5%88%92"><span class="toc-number">1.1.1.</span> <span class="toc-text">一、开发计划</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E4%BB%BB%E5%8A%A1%E5%88%92%E5%88%86"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">（一）任务划分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BF%9B%E5%BA%A6%E5%AE%89%E6%8E%92"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">（二）进度安排</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89%E6%89%A7%E8%A1%8C%E8%AE%B0%E5%BD%95"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">（三）执行记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.1.2.</span> <span class="toc-text">二、设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">（一）需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E7%A1%AE%E5%AE%9A"><span class="toc-number">1.1.2.1.1.</span> <span class="toc-text">功能确定</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E8%AE%BE%E5%A4%87%E5%8F%8A%E7%AB%AF%E5%8F%A3%E7%BB%91%E5%AE%9A"><span class="toc-number">1.1.2.1.2.</span> <span class="toc-text">输入输出设备及端口绑定</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E5%9B%BE"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">（二）系统结构图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89%E7%B3%BB%E7%BB%9F%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">（三）系统执行流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E5%9B%9B%EF%BC%89%E5%AD%90%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">（四）子模块代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B2%E6%8A%96%E6%A8%A1%E5%9D%97-%E5%BB%B6%E6%97%B610ms%E5%BE%97%E5%88%B0%E7%A8%B3%E5%AE%9A%E7%94%B5%E5%B9%B3%E4%BF%A1%E5%8F%B7"><span class="toc-number">1.1.2.5.</span> <span class="toc-text">防抖模块(延时10ms得到稳定电平信号)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E2%80%93-gt-BCD%E8%BD%AC%E6%8D%A2%E6%A8%A1%E5%9D%97-%E9%87%87%E7%94%A8%E6%BB%A15%E5%8A%A03%E7%AE%97%E6%B3%95"><span class="toc-number">1.1.2.6.</span> <span class="toc-text">二进制–&gt;BCD转换模块(采用满5加3算法)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%92%9F%E5%88%86%E9%A2%91%E6%A8%A1%E5%9D%97-%E5%88%86%E9%A2%911s%E6%97%B6%E9%92%9F"><span class="toc-number">1.1.2.7.</span> <span class="toc-text">时钟分频模块(分频1s时钟)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%A9%E5%BA%A6%E6%98%BE%E7%A4%BA%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.8.</span> <span class="toc-text">温度显示模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%B5%E9%87%8F%E6%98%BE%E7%A4%BA%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.9.</span> <span class="toc-text">电量显示模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E6%98%BE%E7%A4%BA%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.10.</span> <span class="toc-text">模式显示模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%85%E7%94%B5%E6%98%BE%E7%A4%BA%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.11.</span> <span class="toc-text">充电显示模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%80%92%E8%AE%A1%E6%97%B6%E6%98%BE%E7%A4%BA%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.12.</span> <span class="toc-text">倒计时显示模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%8E%86%E5%8F%B2%E5%85%85%E5%80%BC%E8%AE%B0%E5%BD%95"><span class="toc-number">1.1.2.13.</span> <span class="toc-text">显示历史充值记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E9%A1%B6%E5%B1%82"><span class="toc-number">1.1.2.14.</span> <span class="toc-text">控制顶层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%B8%A9%E5%BA%A6%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.15.</span> <span class="toc-text">环境温度模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E5%AE%9A%E6%B8%A9%E5%BA%A6%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.16.</span> <span class="toc-text">设定温度模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%B5%E9%87%8F%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.17.</span> <span class="toc-text">电量模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E9%94%AE%E7%9B%98%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.18.</span> <span class="toc-text">小键盘模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E9%94%AE%E7%9B%98%E6%98%A0%E5%B0%84%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.19.</span> <span class="toc-text">小键盘映射模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%B5%E9%87%8F%E5%85%85%E5%80%BC%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.20.</span> <span class="toc-text">电量充值模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%80%92%E8%AE%A1%E6%97%B6%E5%85%B3%E6%9C%BA%E8%BE%93%E5%85%A5%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.21.</span> <span class="toc-text">倒计时关机输入模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%80%92%E8%AE%A1%E6%97%B6%E5%85%B3%E6%9C%BA%E9%A1%B6%E5%B1%82%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.22.</span> <span class="toc-text">倒计时关机顶层模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%A9%E4%BD%9910s%E8%9C%82%E9%B8%A3%E5%99%A8%E6%8F%90%E7%A4%BA%E9%A1%B6%E5%B1%82%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.23.</span> <span class="toc-text">剩余10s蜂鸣器提示顶层模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%9C%82%E9%B8%A3%E5%99%A8%E9%A1%B6%E5%B1%82%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.24.</span> <span class="toc-text">蜂鸣器顶层模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ROM%E9%80%89%E6%8B%A9%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.25.</span> <span class="toc-text">ROM选择模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ROM%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.26.</span> <span class="toc-text">ROM数据记录模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9F%B3%E4%B9%90%E8%A7%A3%E7%A0%81%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.27.</span> <span class="toc-text">音乐解码模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9F%B3%E4%B9%90%E7%94%9F%E6%88%90%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.28.</span> <span class="toc-text">音乐生成模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%85%E5%80%BC%E8%AE%B0%E5%BD%95%E5%8F%8A%E6%9F%A5%E8%AF%A2%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.29.</span> <span class="toc-text">充值记录及查询模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%B4%E7%88%B1%E4%B8%BD%E4%B8%9D-%E5%A4%96%E6%8C%82%E9%9F%B3%E4%B9%90%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.30.</span> <span class="toc-text">致爱丽丝 外挂音乐模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E6%8C%82%E9%9F%B3%E4%B9%90%E6%A8%A1%E5%9D%97-%E9%A2%91%E7%8E%87%E7%94%9F%E6%88%90%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.2.31.</span> <span class="toc-text">外挂音乐模块 频率生成模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%BA%94%EF%BC%89%E7%BA%A6%E6%9D%9F%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.2.32.</span> <span class="toc-text">（五）约束文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-number">1.1.3.</span> <span class="toc-text">三、测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89Testbench%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">（一）Testbench文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E5%AD%90%E6%A8%A1%E5%9D%97%E4%BB%BF%E7%9C%9F%E5%8F%8A%E6%B5%8B%E8%AF%95"><span class="toc-number">1.1.3.1.1.</span> <span class="toc-text">1. 核心子模块仿真及测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%B8%8A%E6%9D%BF%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C%E5%8F%8A%E8%AF%B4%E6%98%8E"><span class="toc-number">1.1.3.1.2.</span> <span class="toc-text">2. 上板测试结果及说明</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E4%B8%8A%E6%9D%BF%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C%E6%8B%8D%E7%85%A7%E5%8F%8A%E8%AF%B4%E6%98%8E"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">（二）上板测试结果拍照及说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.4.</span> <span class="toc-text">四、总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">（一）开发过程中遇到的问题及解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%97%AE%E9%A2%981%EF%BC%9A"><span class="toc-number">1.1.4.1.1.</span> <span class="toc-text">问题1：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="toc-number">1.1.4.1.2.</span> <span class="toc-text">解决方案：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%97%AE%E9%A2%982%EF%BC%9A"><span class="toc-number">1.1.4.1.3.</span> <span class="toc-text">问题2：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A-1"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">解决方案：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9F%E7%89%B9%E8%89%B2%E5%8F%8A%E4%BC%98%E5%8C%96%E6%96%B9%E5%90%91"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">（二）当前系统特色及优化方向</span></a></li></ol></li></ol></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="John Doe"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">John Doe</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">2</span>
        <span class="name">posts</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span>
      <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span>
      <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span>
      <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/01/05/hello-world/" title="Hello World">Hello World</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/01/05/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91project%20(2)/" title="Degital Design Project">Degital Design Project</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2021</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe @ Cheese Bar</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2021/01/05/数字逻辑project (2)/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
